[
  {
    "id": "booking-logs-ui-1",
    "title": "Review booking logs timeline UI and i18n wiring",
    "description": "Review the changes in the booking logs timeline UI. Confirm that the new ActionTitle and JsonViewer components integrate correctly with the tRPC response shape, that avatars and actor roles are rendered safely, and that we do not regress accessibility or i18n behavior. Pay attention to how booking_audit_action.* keys are used and how link components are passed through ServerTrans.",
    "files": "[\n  \"apps/web/modules/booking/logs/views/booking-logs-view.tsx\",\n  \"apps/web/public/static/locales/en/common.json\"\n]",
    "stats": "{\"additions\": 210, \"deletions\": 75, \"risk\": \"MEDIUM\", \"tags\": [\"booking-logs\", \"react\", \"i18n\", \"ui\"]}",
    "insight": "This UI is a primary debugging surface for support and customers. A small regression in how we format dates, JSON, or links will be very visible. Treat the JsonViewer as a mini log viewer and think about default collapsed behavior and performance on large payloads.",
    "diff_refs": "[{\"file\":\"apps/web/modules/booking/logs/views/booking-logs-view.tsx\",\"hunks\":[{\"old_start\":1,\"old_lines\":15,\"new_start\":1,\"new_lines\":32}]},{\"file\":\"apps/web/public/static/locales/en/common.json\",\"hunks\":[{\"old_start\":850,\"old_lines\":2,\"new_start\":850,\"new_lines\":15}]}]",
    "diagram": "{\n  \"type\": \"flow\",\n  \"data\": {\n    \"direction\": \"LR\",\n    \"nodes\": [\n      { \"id\": \"client\", \"label\": \"User\", \"kind\": \"user\" },\n      { \"id\": \"web_app\", \"label\": \"Next.js BookingLogsView\", \"kind\": \"service\" },\n      { \"id\": \"api\", \"label\": \"tRPC getAuditLogs\", \"kind\": \"service\" },\n      { \"id\": \"viewer_service\", \"label\": \"BookingAuditViewerService\", \"kind\": \"service\" },\n      { \"id\": \"repos\", \"label\": \"Repositories\", \"kind\": \"database\" }\n    ],\n    \"edges\": [\n      { \"from\": \"client\", \"to\": \"web_app\", \"label\": \"Open booking logs\" },\n      { \"from\": \"web_app\", \"to\": \"api\", \"label\": \"getAuditLogs\" },\n      { \"from\": \"api\", \"to\": \"viewer_service\", \"label\": \"Fetch audit data\" },\n      { \"from\": \"viewer_service\", \"to\": \"repos\", \"label\": \"Load logs & metadata\" },\n      { \"from\": \"repos\", \"to\": \"viewer_service\", \"label\": \"Raw audit records\" },\n      { \"from\": \"viewer_service\", \"to\": \"api\", \"label\": \"Enriched logs\" },\n      { \"from\": \"api\", \"to\": \"web_app\", \"label\": \"JSON response\" },\n      { \"from\": \"web_app\", \"to\": \"client\", \"label\": \"Render timeline\" }\n    ]\n  }\n}",
    "ai_generated": true,
    "status": "TODO",
    "sub_flow": "Booking logs UI"
  },
  {
    "id": "booking-audit-actions-1",
    "title": "Review booking audit action services and registry",
    "description": "Review the BookingAuditActionServiceRegistry and the action services under packages/features/booking-audit/lib/actions. Confirm that all BookingAuditAction variants are wired into the registry, that migrateToLatest, getDisplayTitle, and getDisplayJson, and getDisplayFields contracts are consistent with IAuditActionService, and that BookingStatusChangeSchema is used where appropriate. Pay attention to how translation keys and params are produced for frontend use.",
    "files": "[\n  \"packages/features/booking-audit/lib/actions/IAuditActionService.ts\",\n  \"packages/features/booking-audit/lib/actions/CreatedAuditActionService.ts\",\n  \"packages/features/booking-audit/lib/actions/RescheduledAuditActionService.ts\",\n  \"packages/features/booking-audit/lib/common/changeSchemas.ts\",\n  \"packages/features/booking-audit/lib/service/BookingAuditActionServiceRegistry.ts\"\n]",
    "stats": "{\"additions\": 260, \"deletions\": 40, \"risk\": \"HIGH\", \"tags\": [\"booking-audit\", \"typescript\", \"domain-model\", \"i18n\"]}",
    "insight": "These action services define the contract between producers, consumers, and the booking logs UI. If the registry mapping or zod schemas drift, we will either drop logs or misrender titles. Review the registry as a single source of truth and think about how we would add a new action in the future without touching too many files.",
    "diff_refs": "[{\"file\":\"packages/features/booking-audit/lib/actions/IAuditActionService.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":21}]},{\"file\":\"packages/features/booking-audit/lib/actions/CreatedAuditActionService.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":35}]},{\"file\":\"packages/features/booking-audit/lib/actions/RescheduledAuditActionService.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":40}]},{\"file\":\"packages/features/booking-audit/lib/common/changeSchemas.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":11}]},{\"file\":\"packages/features/booking-audit/lib/service/BookingAuditActionServiceRegistry.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":48}]}]",
    "diagram": "{\n  \"type\": \"flow\",\n  \"data\": {\n    \"direction\": \"LR\",\n    \"nodes\": [\n      { \"id\": \"producer\", \"label\": \"Producer Service\", \"kind\": \"service\" },\n      { \"id\": \"tasker\", \"label\": \"Tasker Queue\", \"kind\": \"queue\" },\n      { \"id\": \"consumer\", \"label\": \"Task Consumer\", \"kind\": \"service\" },\n      { \"id\": \"registry\", \"label\": \"Action Registry\", \"kind\": \"lambda\" },\n      { \"id\": \"action_services\", \"label\": \"Action Services\", \"kind\": \"service\" },\n      { \"id\": \"repo\", \"label\": \"Audit Repository\", \"kind\": \"database\" }\n    ],\n    \"edges\": [\n      { \"from\": \"producer\", \"to\": \"tasker\", \"label\": \"Queue audit\" },\n      { \"from\": \"producer\", \"to\": \"tasker\", \"label\": \"Enqueue task\" },\n      { \"from\": \"tasker\", \"to\": \"consumer\", \"label\": \"Deliver payload\" },\n      { \"from\": \"consumer\", \"to\": \"registry\", \"label\": \"Get service\" },\n      { \"from\": \"registry\", \"to\": \"action_services\", \"label\": \"Route to action\" },\n      { \"from\": \"action_services\", \"to\": \"consumer\", \"label\": \"Process & migrate\" },\n      { \"from\": \"consumer\", \"to\": \"repo\", \"label\": \"Store versioned data\" }\n    ]\n  }\n}",
    "ai_generated": true,
    "status": "TODO",
    "sub_flow": "Action services and registry"
  },
  {
    "id": "booking-audit-tasks-1",
    "title": "Review booking audit task consumer and producer pipeline",
    "description": "Review the changes in BookingAuditTaskConsumer, BookingAuditTaskerProducerService, bookingAuditTask types, and tasker.ts. Confirm that the lean BookingAuditTaskBasePayload is sufficient for routing, that action-specific zod validation occurs in the right place, and that legacy queueAudit usage remains safe. Pay attention to how errors are logged, how organizationId null cases are handled, and how IS_PRODUCTION influences queueing behavior.",
    "files": "[\n  \"packages/features/booking-audit/lib/types/bookingAuditTask.ts\",\n  \"packages/features/booking-audit/lib/service/BookingAuditTaskConsumer.ts\",\n  \"packages/features/booking-audit/lib/service/BookingAuditTaskerProducerService.ts\",\n  \"packages/features/tasker/tasker.ts\"\n]",
    "stats": "{\"additions\": 310, \"deletions\": 120, \"risk\": \"HIGH\", \"tags\": [\"tasker\", \"queue\", \"booking-audit\", \"typescript\"]}",
    "insight": "This is a good place to think about failure modes. What happens if an action is added to the enum but not to the registry, or vice versa. What happens if a producer passes the wrong data shape. Consider logging, observability, and how we might backfill or replay audit tasks if something goes wrong.",
    "diff_refs": "[{\"file\":\"packages/features/booking-audit/lib/types/bookingAuditTask.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":18}]},{\"file\":\"packages/features/booking-audit/lib/service/BookingAuditTaskConsumer.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":45}]},{\"file\":\"packages/features/booking-audit/lib/service/BookingAuditTaskerProducerService.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":48}]},{\"file\":\"packages/features/tasker/tasker.ts\",\"hunks\":[{\"old_start\":1,\"old_lines\":5,\"new_start\":1,\"new_lines\":6},{\"old_start\":15,\"old_lines\":2,\"new_start\":16,\"new_lines\":7}]}]",
    "diagram": "{\n  \"type\": \"flow\",\n  \"data\": {\n    \"direction\": \"LR\",\n    \"nodes\": [\n      { \"id\": \"api\", \"label\": \"Booking Service\", \"kind\": \"service\" },\n      { \"id\": \"producer\", \"label\": \"BookingAuditTasker ProducerService\", \"kind\": \"service\" },\n      { \"id\": \"tasker\", \"label\": \"Tasker bookingAudit\", \"kind\": \"queue\" },\n      { \"id\": \"consumer\", \"label\": \"BookingAuditTask Consumer\", \"kind\": \"service\" },\n      { \"id\": \"registry\", \"label\": \"Action Service Registry\", \"kind\": \"lambda\" },\n      { \"id\": \"repo\", \"label\": \"BookingAudit Repository\", \"kind\": \"database\" }\n    ],\n    \"edges\": [\n      { \"from\": \"api\", \"to\": \"producer\", \"label\": \"queueCreatedAudit, queueRescheduledAudit\" },\n      { \"from\": \"producer\", \"to\": \"tasker\", \"label\": \"create task with base payload\" },\n      { \"from\": \"tasker\", \"to\": \"consumer\", \"label\": \"deliver payload\" },\n      { \"from\": \"consumer\", \"to\": \"registry\", \"label\": \"getActionService\" },\n      { \"from\": \"registry\", \"to\": \"consumer\", \"label\": \"return typed service\" },\n      { \"from\": \"consumer\", \"to\": \"repo\", \"label\": \"insert audit row with versioned data\" }\n    ]\n  }\n}",
    "ai_generated": true,
    "status": "TODO",
    "sub_flow": "Task processing pipeline"
  },
  {
    "id": "booking-audit-viewer-1",
    "title": "Review BookingAuditViewerService and reschedule context handling",
    "description": "Review BookingAuditViewerService and the new container module. Confirm that getAuditLogsForBooking enriches actors correctly, calls getDisplayTitle and getDisplayJson on the right action services, and handles missing or malformed data defensively. Pay special attention to the rescheduled from logic that pulls RESCHEDULED logs from the previous booking and injects a synthetic entry at the top of the timeline for the current booking.",
    "files": "[\n  \"packages/features/booking-audit/lib/service/BookingAuditViewerService.ts\",\n  \"packages/features/bookings/repositories/BookingRepository.ts\"\n]",
    "stats": "{\"additions\": 230, \"deletions\": 60, \"risk\": \"MEDIUM\", \"tags\": [\"booking-audit\", \"viewer\", \"typescript\"]}",
    "insight": "The viewer service is the bridge between storage and UI. The new 'rescheduled from' synthetic log is a good place to look for off-by-one style bugs or confusing ownership of bookingUid. Think about how this behaves for long reschedule chains and how we might test that in isolation.",
    "diff_refs": "[{\"file\":\"packages/features/booking-audit/lib/service/BookingAuditViewerService.ts\",\"hunks\":[{\"old_start\":0,\"old_lines\":0,\"new_start\":1,\"new_lines\":67}]},{\"file\":\"packages/features/bookings/repositories/BookingRepository.ts\",\"hunks\":[{\"old_start\":50,\"old_lines\":3,\"new_start\":50,\"new_lines\":13}]}]",
    "diagram": "{\n  \"type\": \"flow\",\n  \"data\": {\n    \"direction\": \"LR\",\n    \"nodes\": [\n      { \"id\": \"web_api\", \"label\": \"tRPC endpoint tviewer.bookings.getAuditLogs\", \"kind\": \"service\" },\n      { \"id\": \"viewer\", \"label\": \"BookingAuditViewerService\", \"kind\": \"service\" },\n      { \"id\": \"audit_repo\", \"label\": \"BookingAudit Repository\", \"kind\": \"database\" },\n      { \"id\": \"booking_repo\", \"label\": \"Booking Repository\", \"kind\": \"database\" },\n      { \"id\": \"registry\", \"label\": \"Action Service Registry\", \"kind\": \"lambda\" },\n      { \"id\": \"rescheduled_svc\", \"label\": \"Rescheduled AuditActionService\", \"kind\": \"service\" }\n    ],\n    \"edges\": [\n      { \"from\": \"web_api\", \"to\": \"viewer\", \"label\": \"bookingUid, userTimeZone\" },\n      { \"from\": \"viewer\", \"to\": \"audit_repo\", \"label\": \"findAllForBooking\" },\n      { \"from\": \"viewer\", \"to\": \"booking_repo\", \"label\": \"getFromRescheduleUid\" },\n      { \"from\": \"booking_repo\", \"to\": \"viewer\", \"label\": \"fromRescheduleUid or null\" },\n      { \"from\": \"viewer\", \"to\": \"registry\", \"label\": \"getActionService\" },\n      { \"from\": \"registry\", \"to\": \"viewer\", \"label\": \"action service\" },\n      { \"from\": \"viewer\", \"to\": \"audit_repo\", \"label\": \"findRescheduled logs of booking\" },\n      { \"from\": \"viewer\", \"to\": \"rescheduled_svc\", \"label\": \"build rescheduled-from title\" },\n      { \"from\": \"viewer\", \"to\": \"web_api\", \"label\": \"enriched logs with actionDisplayTitle data, displayFields\" }\n    ]\n  }\n}",
    "ai_generated": true,
    "status": "TODO",
    "sub_flow": "Viewer and reschedule context"
  },
  {
    "id": "booking-audit-di-1",
    "title": "Review DI wiring, actor helpers, and repository extensions",
    "description": "Review the DI module changes and small helpers added around actors and booking repository. Confirm that BookingAuditTaskConsumer and BookingAuditViewerService receive the correct dependencies (userRepository, bookingRepository, logger, tasker), and that makeAttendeeActor and getFromRescheduleUid behave as expected. This task is mainly about wiring and future maintainability rather than deep business logic.",
    "files": "[\n  \"packages/features/booking-audit/di/BookingAuditTaskConsumer.module.ts\",\n  \"packages/features/booking-audit/di/BookingAuditTaskerProducerService.module.ts\",\n  \"packages/features/booking-audit/di/BookingAuditViewerService.module.ts\",\n  \"packages/features/bookings/lib/types/actor.ts\",\n  \"packages/features/bookings/repositories/BookingRepository.ts\"\n]",
    "stats": "{\"additions\": 95, \"deletions\": 18, \"risk\": \"LOW\", \"tags\": [\"di\", \"wiring\", \"booking-audit\"]}",
    "insight": "These are the edges of the system. If a DI token or module wiring is wrong, audit logs will silently stop recording or viewing without obvious type errors. Treat this as a sanity check that the booking audit stack is reachable in real environments, not just in tests.",
    "diff_refs": null,
    "diagram": "{\n  \"type\": \"flow\",\n  \"data\": {\n    \"direction\": \"TB\",\n    \"nodes\": [\n      { \"id\": \"container\", \"label\": \"DI Container\", \"kind\": \"service\" },\n      { \"id\": \"tasker_mod\", \"label\": \"Tasker Module\", \"kind\": \"service\" },\n      { \"id\": \"logger_mod\", \"label\": \"Logger Module\", \"kind\": \"service\" },\n      { \"id\": \"consumer_mod\", \"label\": \"BookingAuditTaskConsumer Module\", \"kind\": \"service\" },\n      { \"id\": \"producer_mod\", \"label\": \"BookingAuditTaskerProducerService Module\", \"kind\": \"service\" },\n      { \"id\": \"viewer_mod\", \"label\": \"BookingAuditViewerService Module\", \"kind\": \"service\" }\n    ],\n    \"edges\": [\n      { \"from\": \"container\", \"to\": \"tasker_mod\", \"label\": \"load tasker\" },\n      { \"from\": \"container\", \"to\": \"logger_mod\", \"label\": \"load logger\" },\n      { \"from\": \"container\", \"to\": \"consumer_mod\", \"label\": \"bind consumer deps: repositories, features, user repo\" },\n      { \"from\": \"container\", \"to\": \"producer_mod\", \"label\": \"bind producer deps: tasker, logger\" },\n      { \"from\": \"container\", \"to\": \"viewer_mod\", \"label\": \"bind viewer deps: audit repo, user repo, booking repo\" }\n    ]\n  }\n}",
    "ai_generated": true,
    "status": "TODO",
    "sub_flow": "DI and repositories"
  }
]
