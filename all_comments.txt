src/ui/icons.rs:1://! Centralized icon registry for LaReview.
src/ui/icons.rs:2://!
src/ui/icons.rs:3://! All UI components should use these constants instead of directly
src/ui/icons.rs:4://! referencing `egui_phosphor` to ensure visual consistency.
src/ui/icons.rs:8:// --- Task & Feedback Status ---
src/ui/icons.rs:15:// --- Risk Levels ---
src/ui/icons.rs:20:// --- Navigation & Views ---
src/ui/icons.rs:31:// --- Common Actions ---
src/ui/icons.rs:48:// --- Symbols ---
src/ui/icons.rs:63:// --- Impact ---
src/ui/app/header.rs:19:            uri: "bytes://header_logo.svg",
src/ui/app/header.rs:36:                // --- 1. LEFT: App Identity ---
src/ui/app/header.rs:63:                // --- 2. CENTER: Navigation Tabs ---
src/ui/app/header.rs:97:                let container_width = total_tabs_width + 12.0; // 6.0 inner margin on each side
src/ui/app/header.rs:159:        // Ensure full opacity
src/ui/app/header.rs:169:        // Draw Icon
src/ui/app/header.rs:201:        // Draw Label
src/ui/app/tests/review.rs:159:    // Skip assertions that fail due to animations
src/ui/app/tests/review.rs:160:    // harness.run();
src/ui/app/tests/generate.rs:75:    // Empty text should disable the button
src/ui/app/tests/generate.rs:154:    // Note: The button is actually NOT disabled currently if diff_text is not empty,
src/ui/app/tests/generate.rs:155:    // even if preview fetching failed. This allows the user to try running anyway.
src/ui/app/tests/overlay.rs:22:    // Check if window with title exists
src/ui/app/tests/overlay.rs:25:    // Click Close button
src/ui/app/tests/overlay.rs:33:    // Simulate reducer closing it
src/ui/app/tests/overlay.rs:57:    // Use Role::Window to uniquely identify the modal
src/ui/app/tests/overlay.rs:64:    // Find Cancel button
src/ui/app/tests/fixtures.rs:71:    // Save to DB
src/ui/app/tests/fixtures.rs:77:    // Populate state
src/ui/app/tests/unit.rs:33:    // If no run selected, returns all
src/ui/app/tests/unit.rs:37:    // Filter by run_1
src/ui/app/tests/unit.rs:56:    assert_eq!(grouped.len(), 3); // None, Flow A, Flow B
src/ui/app/tests/unit.rs:375:    assert!(!app.state.session.is_generating); // GenerationAction::Done should clear it (via reducer)
src/ui/app/tests/unit.rs:435:    // This just dispatches an action, since skip_runtime is true it does nothing else.
src/ui/app/tests/unit.rs:443:    // The seed_db uses LAREVIEW_DB_PATH
src/ui/app/tests/unit.rs:448:    // We can't directly call bin/seed_db.rs main easily if it's not a library,
src/ui/app/tests/unit.rs:449:    // but we can use `run_shell_command` or just accept that we've covered the code
src/ui/app/tests/unit.rs:450:    // if we were to move the logic to a library.
src/ui/app/tests/unit.rs:451:    // However, I'll try to run it via cargo.
src/ui/app/tests/settings.rs:19:    // Verify modal is visible
src/ui/app/tests/settings.rs:22:    // Click "Dismiss"
src/ui/app/tests/repos.rs:55:    // Simulate what reducer does: remove repo
src/ui/app/update.rs:15:        // Set the base Catppuccin theme for overall UI appearance
src/ui/app/update.rs:18:        // Apply TUI-like visuals: disable corner rounding and set terminal backgrounds
src/ui/app/update.rs:22:        // Backgrounds
src/ui/app/update.rs:26:        // Borders and Backgrounds for Widgets - TUI style (transparent bg, solid border)
src/ui/app/update.rs:34:        visuals.widgets.hovered.bg_fill = theme.bg_secondary; // Subtle lift on hover
src/ui/app/update.rs:42:        // Selection
src/ui/app/update.rs:46:        // Corner Radii
src/ui/app/mod.rs:1://! Main application state and UI logic for the LaReview application.
src/ui/app/mod.rs:2://!
src/ui/app/mod.rs:3://! This module contains the primary egui application state, async message plumbing, and the root
src/ui/app/mod.rs:4://! `eframe::App` implementation.
src/ui/app/state.rs:10:/// Which screen is active.
src/ui/app/state.rs:83:    /// String is feedback_id
src/ui/app/state.rs:90:/// Which agent is selected.
src/ui/app/state.rs:131:/// Domain-related persistent state.
src/ui/app/state.rs:143:/// State related to the active agent session.
src/ui/app/state.rs:267:/// Transient UI state.
src/ui/app/state.rs:293:    // Feedback â†’ PR sync
src/ui/app/state.rs:297:    // Agent settings
src/ui/app/state.rs:301:    // --- Export UI ---
src/ui/app/state.rs:313:/// All app state in one struct.
src/ui/app/root.rs:1://! Root egui app struct.
src/ui/app/root.rs:16:/// Root egui application for LaReview.
src/ui/app/ui_memory.rs:1://! Transient UI state stored in egui's memory system.
src/ui/app/ui_memory.rs:2://!
src/ui/app/ui_memory.rs:3://! This module provides ephemeral UI state that persists between frames but
src/ui/app/ui_memory.rs:4://! is not persisted to disk. Use this for drag handles, text drafts, form toggles,
src/ui/app/ui_memory.rs:5://! and other purely visual state that doesn't need to survive app restarts.
src/ui/app/ui_memory.rs:14:/// egui Id for accessing UiMemory
src/ui/app/ui_memory.rs:17:/// UI state stored in egui's memory system.
src/ui/app/ui_memory.rs:18:/// Persists between frames, not persisted to disk.
src/ui/app/ui_memory.rs:21:    /// Export overlay state
src/ui/app/ui_memory.rs:23:    /// Feedback form drafts, keyed by feedback_id (or "new" for new feedback)
src/ui/app/ui_memory.rs:25:    /// Cached unified diff text, keyed by cache key (derived from task_id + diff_refs hash)
src/ui/app/ui_memory.rs:27:    /// Settings modal state
src/ui/app/ui_memory.rs:31:/// Export overlay transient state
src/ui/app/ui_memory.rs:34:    /// Sidebar width in pixels
src/ui/app/ui_memory.rs:46:/// Feedback form draft state
src/ui/app/ui_memory.rs:49:    /// Title draft text
src/ui/app/ui_memory.rs:51:    /// Reply draft text
src/ui/app/ui_memory.rs:55:/// Settings modal transient state
src/ui/app/ui_memory.rs:58:    /// Environment variable draft key
src/ui/app/ui_memory.rs:60:    /// Environment variable draft value
src/ui/app/ui_memory.rs:62:    /// Custom agent draft form
src/ui/app/ui_memory.rs:64:    /// Agent ID being edited in settings
src/ui/app/ui_memory.rs:66:    /// Add custom agent modal visibility
src/ui/app/ui_memory.rs:68:    /// Snapshot of agent settings for dirty checking
src/ui/app/ui_memory.rs:73:    /// Get feedback draft for a specific feedback ID, or "new" for new feedback
src/ui/app/ui_memory.rs:81:    /// Clear feedback draft after successful submission
src/ui/app/ui_memory.rs:86:    /// Get cached diff for given cache key (typically task_id)
src/ui/app/ui_memory.rs:91:    /// Cache a unified diff
src/ui/app/ui_memory.rs:96:    /// Generate a draft key for a feedback item
src/ui/app/ui_memory.rs:111:/// Get a reference to UiMemory from egui context
src/ui/app/ui_memory.rs:120:/// Mutate UiMemory in egui context
src/ui/app/generate_input.rs:132:                .unwrap_or_else(|| format!("https://github.com/{owner}/{repo}/pull/{number}")),
src/ui/app/init.rs:27:        // Load Geist for proportional text
src/ui/app/init.rs:54:        // Load Geist Mono for monospace text
src/ui/app/init.rs:76:        // Pre-bind custom names to standard families to avoid panics if they are not yet fully loaded
src/ui/app/messages.rs:20:/// Payload we care about from ACP.
src/ui/app/messages.rs:29:/// Messages coming back from the async generation task.
src/ui/app/store/action.rs:139:    // Agent settings
src/ui/app/store/action.rs:140:    UpdateAgentPath(String, String), // agent_id, path
src/ui/app/store/action.rs:142:    DeleteCustomAgent(String),              // agent_id
src/ui/app/store/action.rs:143:    UpdateAgentEnv(String, String, String), // agent_id, key, value
src/ui/app/store/action.rs:144:    RemoveAgentEnv(String, String),         // agent_id, key
src/ui/app/store/runtime/review.rs:416:            // Count the hunk header line.
src/ui/app/store/runtime/generate.rs:81:    // Abort existing if any
src/ui/app/store/runtime/tests.rs:15:    // Polling action messages to process the AsyncAction::TaskStatusSaved
src/ui/app/store/runtime/tests.rs:18:    // We expect an error because the task doesn't exist in the in-memory DB,
src/ui/app/store/runtime/tests.rs:19:    // but the code should have been executed.
src/ui/app/store/runtime/tests.rs:37:    // Wait a bit for tokio::spawn to finish
src/ui/app/store/runtime/tests.rs:67:    // Create review and feedback
src/ui/app/store/runtime/tests.rs:109:    // Create review first
src/ui/app/store/runtime/tests.rs:151:    // Create review first
src/ui/app/store/runtime/tests.rs:237:    // Wait for async
src/ui/app/store/runtime/tests.rs:239:    // Poll messages - RefreshReviewData is synchronous but it dispatches an Async action
src/ui/app/store/runtime/tests.rs:248:    // 1. Create a review first
src/ui/app/store/runtime/tests.rs:262:    // 1.5 Create a run and a task
src/ui/app/store/runtime/tests.rs:290:    // 2. Create a comment (new feedback)
src/ui/app/store/runtime/tests.rs:310:    // 3. Add a reply to existing feedback
src/ui/app/store/runtime/tests.rs:332:    // Setup data
src/ui/app/store/runtime/tests.rs:374:    // Setup data
src/ui/app/store/runtime/tests.rs:419:    // Error case: review not found
src/ui/app/store/runtime/tests.rs:426:    // Error case: review found but not GitHub
src/ui/app/store/runtime/settings.rs:57:        D2Command::Install => "curl -fsSL https://d2lang.com/install.sh | sh -s --",
src/ui/app/store/runtime/settings.rs:58:        D2Command::Uninstall => "curl -fsSL https://d2lang.com/install.sh | sh -s -- --uninstall",
src/ui/app/store/reducer/review.rs:7:use std::path::Path; // Keep Path as it's used
src/ui/app/store/reducer/review.rs:8:// The user's diff suggested adding HashMap and removing Path, but Path is used.
src/ui/app/store/reducer/review.rs:9:// The instruction was "remove unused HashSet import" which is not present.
src/ui/app/store/reducer/review.rs:10:// I will keep Path and not add HashMap as it's not used.
src/ui/app/store/reducer/review.rs:15:            // 1. Select the task (this usually clears active_feedback, so we do it first)
src/ui/app/store/reducer/review.rs:19:                // 2. Set the active feedback context
src/ui/app/store/reducer/review.rs:36:            // 3. Ensure we are on the Review view
src/ui/app/store/reducer/review.rs:118:            // If the deleted review was selected, deselect it
src/ui/app/store/reducer/review.rs:216:            // Initialize title draft from existing thread data
src/ui/app/store/reducer/review.rs:422:                // Trigger regeneration
src/ui/app/store/reducer/review.rs:451:                // Trigger regeneration
src/ui/app/store/reducer/generate.rs:44:            // Auto-fetch PR context if it looks like a GitHub PR ref
src/ui/app/store/reducer/generate.rs:114:                        // Try to auto-select repo by matching "owner/repo" in remotes
src/ui/app/store/reducer/mod.rs:674:        let pr_url = "https://github.com/owner/repo/pull/123";
src/ui/app/store/reducer/mod.rs:748:            remotes: vec!["https://github.com/owner/repo.git".into()],
src/ui/app/store/mod.rs:1://! Reducer-style state updates + side-effect commands.
src/ui/window.rs:7:/// Applies native rounded corners to the window if supported on the current platform.
src/ui/window.rs:8:/// This should be called once after the window is created.
src/ui/window.rs:9:///
src/ui/window.rs:10:/// For the main window, use this function with the `Frame` from `eframe::App::update`.
src/ui/window.rs:21:/// Internal helper to apply rounded corners from a window handle
src/ui/theme.rs:1:#![allow(dead_code)] // Allow unused fields - comprehensive theme definition for consistency
src/ui/theme.rs:3://! Theme definitions for LaReview
src/ui/theme.rs:4://!
src/ui/theme.rs:5://! This module provides semantic color names built on top of the Catppuccin Mocha palette
src/ui/theme.rs:6://! for consistent and accessible theming throughout the application.
src/ui/theme.rs:11:/// Semantic color theme that builds upon the Catppuccin Mocha palette
src/ui/theme.rs:14:    // Background colors with matching text colors for accessibility
src/ui/theme.rs:15:    /// Primary background - main application surface
src/ui/theme.rs:17:    /// Primary text color that contrasts well with bg_primary
src/ui/theme.rs:20:    /// Secondary background - cards, panels, elevated surfaces
src/ui/theme.rs:22:    /// Text color that contrasts well with bg_secondary
src/ui/theme.rs:25:    /// Tertiary background - subtle surfaces
src/ui/theme.rs:27:    /// Text color that contrasts well with bg_tertiary
src/ui/theme.rs:30:    /// Surface background - dialogs, dropdowns
src/ui/theme.rs:32:    /// Text color that contrasts well with bg_surface
src/ui/theme.rs:35:    /// Muted background - for less prominent elements
src/ui/theme.rs:37:    /// Text color that contrasts well with bg_muted
src/ui/theme.rs:40:    /// Card background - for individual cards
src/ui/theme.rs:42:    /// Text color that contrasts well with bg_card
src/ui/theme.rs:45:    // Brand colors
src/ui/theme.rs:46:    /// Primary brand color
src/ui/theme.rs:48:    /// Brand foreground color (text/icon on brand backgrounds)
src/ui/theme.rs:51:    // --- Standardized Enum Colors ---
src/ui/theme.rs:53:    // ReviewStatus Colors
src/ui/theme.rs:54:    /// Status: Todo
src/ui/theme.rs:56:    /// Status: In Progress
src/ui/theme.rs:58:    /// Status: Done
src/ui/theme.rs:60:    /// Status: Ignored
src/ui/theme.rs:63:    // FeedbackImpact Colors
src/ui/theme.rs:64:    /// Impact: Nitpick
src/ui/theme.rs:66:    /// Impact: Nice to Have
src/ui/theme.rs:68:    /// Impact: Blocking
src/ui/theme.rs:71:    // RiskLevel Colors
src/ui/theme.rs:72:    /// Risk: Low
src/ui/theme.rs:74:    /// Risk: Medium
src/ui/theme.rs:76:    /// Risk: High
src/ui/theme.rs:79:    // Semantic status colors
src/ui/theme.rs:80:    /// Success state color
src/ui/theme.rs:82:    /// Success foreground color
src/ui/theme.rs:85:    /// Warning state color
src/ui/theme.rs:87:    /// Warning foreground color
src/ui/theme.rs:90:    /// Destructive/error state color
src/ui/theme.rs:92:    /// Destructive foreground color
src/ui/theme.rs:95:    /// Accent color (secondary brand color)
src/ui/theme.rs:97:    /// Accent foreground color
src/ui/theme.rs:100:    // Text hierarchy
src/ui/theme.rs:101:    /// Text for inverse situations (dark bg, light text)
src/ui/theme.rs:103:    /// Disabled text color
src/ui/theme.rs:105:    /// Muted text color (less important than primary)
src/ui/theme.rs:108:    // Border colors
src/ui/theme.rs:109:    /// Primary border color
src/ui/theme.rs:111:    /// Secondary border color
src/ui/theme.rs:114:    // Special colors
src/ui/theme.rs:115:    /// Transparent color
src/ui/theme.rs:118:    /// Color for selected interactive elements
src/ui/theme.rs:121:    /// Accent text color
src/ui/theme.rs:126:    /// Creates a new theme based on the Catppuccin Mocha palette
src/ui/theme.rs:129:            // Background-text pairs for accessibility
src/ui/theme.rs:130:            bg_primary: MOCHA.base, // Standard dark background (Lighter than crust)
src/ui/theme.rs:131:            text_primary: egui::Color32::from_rgb(230, 233, 239), // Brighter white (Mocha text is slightly muted)
src/ui/theme.rs:133:            bg_secondary: MOCHA.mantle, // Elevated surfaces (Sidebars, Header)
src/ui/theme.rs:136:            bg_tertiary: MOCHA.surface0, // Elevated surfaces (Cards, focus areas)
src/ui/theme.rs:139:            bg_surface: MOCHA.mantle, // Dialogs and dropdowns
src/ui/theme.rs:142:            bg_muted: MOCHA.surface0, // Muted surfaces
src/ui/theme.rs:145:            bg_card: MOCHA.mantle, // Individual cards
src/ui/theme.rs:148:            // Brand colors
src/ui/theme.rs:149:            brand: MOCHA.mauve, // Primary terminal brand color
src/ui/theme.rs:152:            // --- Standardized Enum Colors ---
src/ui/theme.rs:154:            // ReviewStatus
src/ui/theme.rs:160:            // FeedbackImpact
src/ui/theme.rs:165:            // RiskLevel
src/ui/theme.rs:170:            // Status colors
src/ui/theme.rs:183:            // Text hierarchy
src/ui/theme.rs:188:            // Border colors
src/ui/theme.rs:189:            border: MOCHA.surface1,           // Subtle borders
src/ui/theme.rs:190:            border_secondary: MOCHA.surface0, // Very subtle borders
src/ui/theme.rs:192:            // Special colors
src/ui/theme.rs:201:    /// Gets the theme based on current application settings
src/ui/theme.rs:202:    /// Currently just returns the Mocha theme but could be extended for theme switching
src/ui/theme.rs:208:/// Global instance of the current theme
src/ui/theme.rs:209:/// This can be accessed throughout the application for consistent theming
src/ui/theme.rs:214:/// Module with common color utilities
src/ui/theme.rs:216:    /// Transparent color constant
src/ui/spacing.rs:1://! Standardized spacing constants for consistent UI in LaReview.
src/ui/spacing.rs:2://!
src/ui/spacing.rs:3://! This module defines a consistent spacing scale to maintain visual consistency
src/ui/spacing.rs:4://! across all UI components in the application.
src/ui/spacing.rs:5://!
src/ui/spacing.rs:6://! All constants are f32 by default. Use .into() or as i8 when i8 values are needed
src/ui/spacing.rs:7://! for margin APIs.
src/ui/spacing.rs:11:/// Extra small spacing value (4px)
src/ui/spacing.rs:14:/// Thin resize handle width (1px)
src/ui/spacing.rs:17:/// Small spacing value (8px)
src/ui/spacing.rs:20:/// Small spacing value (8px)
src/ui/spacing.rs:23:/// Medium spacing value (12px)
src/ui/spacing.rs:26:/// Large spacing value (16px)
src/ui/spacing.rs:29:/// Extra large spacing value (24px)
src/ui/spacing.rs:32:/// Button padding (8px horizontal, 4px vertical) - for temporary UI changes
src/ui/spacing.rs:35:/// Standard item spacing (8px horizontal, 6px vertical) - for temporary UI changes
src/ui/spacing.rs:38:/// Tight item spacing (4px horizontal, 4px vertical) - for temporary UI changes
src/ui/spacing.rs:41:/// Standard corner radius for small elements (chips, badges, etc.)
src/ui/spacing.rs:44:/// Standard corner radius for medium elements (buttons, smaller cards, etc.)
src/ui/spacing.rs:47:/// Standard corner radius for large elements (main cards, sections, etc.)
src/ui/typography.rs:27:/// Returns a RichText configured with the Proportional font family and strong weight.
src/ui/typography.rs:32:/// Returns a RichText configured with the Proportional font family.
src/ui/typography.rs:37:/// Large bold heading
src/ui/typography.rs:43:/// Medium bold heading
src/ui/typography.rs:49:/// Standard UI label size (small)
src/ui/typography.rs:54:/// Bold UI label size (13.0)
src/ui/typography.rs:59:/// Small text
src/ui/typography.rs:64:/// Extra small text
src/ui/typography.rs:69:/// Muted body text
src/ui/typography.rs:74:/// Returns a RichText configured with the Monospace font family.
src/ui/typography.rs:79:/// Small monospace text
src/ui/typography.rs:84:// --- FontId Helpers ---
src/ui/components/repo_selector.rs:26:        // 1. Draw the "ComboBox" button manually
src/ui/components/repo_selector.rs:37:        // Draw button background / border
src/ui/components/repo_selector.rs:63:        // Draw Content
src/ui/components/repo_selector.rs:70:                // Icon
src/ui/components/repo_selector.rs:78:                // Text
src/ui/components/repo_selector.rs:90:                // Chevron
src/ui/components/repo_selector.rs:101:        // 2. Draw Popup
src/ui/components/repo_selector.rs:119:                        // Option: None
src/ui/components/repo_selector.rs:267:        // Popup is open, should see "Repo 1"
src/ui/components/list_item.rs:75:        // We need to allocate space first to handle hover state for background
src/ui/components/list_item.rs:76:        // But since we want the background to cover the whole area including padding,
src/ui/components/list_item.rs:77:        // we use a Frame.
src/ui/components/list_item.rs:88:        // We need to handle interaction. The Frame doesn't directly return an Interact/Response
src/ui/components/list_item.rs:89:        // that covers the whole area easily unless we treat the content as the interactive part.
src/ui/components/list_item.rs:90:        // However, standard egui pattern for selectable list items often involves allocating the rect first
src/ui/components/list_item.rs:91:        // or using `ui.interact`.
src/ui/components/list_item.rs:93:        // Let's use `frame.show` and interact with the inner response,
src/ui/components/list_item.rs:94:        // but we might want the hover effect to be on the *frame* area.
src/ui/components/list_item.rs:95:        // A common trick is to use `ui.scope` or just rely on the fact that if we click the content, it works.
src/ui/components/list_item.rs:96:        // To make the WHOLE frame clickable and hoverable (changing bg), we can use a button-like behavior
src/ui/components/list_item.rs:97:        // or manually paint the background on hover.
src/ui/components/list_item.rs:99:        // Let's manually handle the background on hover to match `thread_list.rs` behavior logic
src/ui/components/list_item.rs:100:        // which was: draw transparent rect, check hover, paint rect if hovered.
src/ui/components/list_item.rs:102:        // Allocate space? No, let's just use the Frame, get the response, and then check interactions.
src/ui/components/list_item.rs:108:                    // Top-align the icon with the title
src/ui/components/list_item.rs:109:                    // To do this, we can't just center vertically.
src/ui/components/list_item.rs:110:                    // We'll use a specific vertical alignment or just lay them out.
src/ui/components/list_item.rs:113:                        // We want the icon to be aligned with the first line of text.
src/ui/components/list_item.rs:114:                        // A simple way is to use `ui.with_layout` to align to TOP-LEFT.
src/ui/components/list_item.rs:116:                            // Add a little vertical spacing if needed to visually center with text cap height
src/ui/components/list_item.rs:117:                            // But usually straight top align is fine if fonts match.
src/ui/components/list_item.rs:118:                            // Let's add a tiny bit of spacing if the font size difference is large.
src/ui/components/list_item.rs:119:                            // Assuming standard icon size 16.0 and text 13.0/14.0.
src/ui/components/list_item.rs:143:        // Interaction
src/ui/components/list_item.rs:146:        // Hover Effect
src/ui/components/list_item.rs:148:            // Paint the hover background behind the content
src/ui/components/list_item.rs:149:            // We need to be careful about z-index or just paint it.
src/ui/components/list_item.rs:150:            // Since we already painted a transparent/selected background in Frame,
src/ui/components/list_item.rs:151:            // we can paint over it or use the painter to paint *before* if we were allocating manually.
src/ui/components/list_item.rs:152:            // But `frame.fill` happened already.
src/ui/components/list_item.rs:154:            // `thread_list.rs` did: `bg_shape_idx = ui.painter().add(egui::Shape::Noop)` BEFORE content
src/ui/components/list_item.rs:155:            // then `ui.painter().set(...)` AFTER content if hovered.
src/ui/components/list_item.rs:156:            // That is a cleaner way to handle "hover style on top" or "replace background".
src/ui/components/list_item.rs:158:            // However, since we are inside `show`, we can't easily modify the *previous* frame's fill
src/ui/components/list_item.rs:159:            // unless we used that `Shape::Noop` trick.
src/ui/components/list_item.rs:161:            // Simplified approach for now:
src/ui/components/list_item.rs:162:            // Just rely on egui's immediate mode: checking hover *after* drawing is too late for *this* frame's background
src/ui/components/list_item.rs:163:            // unless we use layers or the shape trick.
src/ui/components/list_item.rs:164:            // Given I want to preserve the `thread_list` logic which worked well:
src/ui/components/list_item.rs:167:        // Let's rewrite `show` to use the Shape trick for perfect hover states.
src/ui/components/list_item.rs:169:        // Re-do show logic
src/ui/components/list_item.rs:171:        // 1. Get rect/layout
src/ui/components/list_item.rs:172:        // But we have dynamic content heavily dependent on width.
src/ui/components/list_item.rs:173:        // So we really want `frame.show`.
src/ui/components/list_item.rs:175:        // Let's stick to the `thread_list.rs` implementation pattern exactly.
src/ui/components/list_item.rs:183:        // Handle click
src/ui/components/list_item.rs:190:        // Return response so caller can use it if needed (e.g. for context menu)
src/ui/components/list_item.rs:195:// Redefining show with the Shape trick for background
src/ui/components/list_item.rs:202:        // Placeholder for background
src/ui/components/list_item.rs:212:            // We do NOT set fill here, we handle it manually
src/ui/components/list_item.rs:219:                    // Align Top
src/ui/components/list_item.rs:223:                                ui.add_space(2.0); // Optical alignment
src/ui/components/list_item.rs:253:                            // Icon Column
src/ui/components/list_item.rs:255:                                // ensure icon is positioned correctly, maybe add small Y offset to optical center with text
src/ui/components/list_item.rs:261:                        // Text Column
src/ui/components/list_item.rs:286:        // Hover logic
src/ui/components/list_item.rs:294:            bg_color = theme.bg_secondary; // Or a slightly lighter/different shade if needed, but usually same as active or slightly simpler
src/ui/components/list_item.rs:301:                    response.rect, // Fill the whole allocated rect
src/ui/components/list_item.rs:413:        // Find the checkbox and click it
src/ui/components/diagram.rs:15:// DiagramSvg removed - now using PixelsReady(egui::ColorImage)
src/ui/components/diagram.rs:30:/// Internal state stored in egui memory for diagram management
src/ui/components/diagram.rs:50:// Global storage for receivers and fonts
src/ui/components/diagram.rs:56:/// Renders a D2 diagram using egui Scene for zooming.
src/ui/components/diagram.rs:57:/// Manages all state internally using egui's memory system.
src/ui/components/diagram.rs:58:/// Returns true if the user clicks the "Go to Settings" link.
src/ui/components/diagram.rs:59:///
src/ui/components/diagram.rs:60:/// This is fully self-contained - just pass the diagram code and dark mode flag.
src/ui/components/diagram.rs:64:    // Generate stable ID for memory storage
src/ui/components/diagram.rs:82:    // Parse JSON -> Diagram -> D2
src/ui/components/diagram.rs:113:        // Check if we need to start generation
src/ui/components/diagram.rs:117:            // Create channel for receiving result
src/ui/components/diagram.rs:120:            // Store receiver in global storage
src/ui/components/diagram.rs:125:            // Spawn background task to generate SVG and rasterize it
src/ui/components/diagram.rs:134:                        // Background Rasterization using resvg
src/ui/components/diagram.rs:146:                                // Calculate scaling to fit SVG_RASTER_SIZE while maintaining aspect ratio
src/ui/components/diagram.rs:176:                // Send result through channel
src/ui/components/diagram.rs:179:                // Request repaint
src/ui/components/diagram.rs:188:            // Try to receive result without blocking
src/ui/components/diagram.rs:226:    // If expanded, show in full-screen overlay
src/ui/components/diagram.rs:261:                    true, // is_expanded
src/ui/components/diagram.rs:265:        // Inline compact view with expand button
src/ui/components/diagram.rs:280:                    false, // is_expanded
src/ui/components/diagram.rs:318:            // Use available width but force a reasonable height for centering if it's too small
src/ui/components/diagram.rs:358:                // `Scene` uses scroll input for pan/zoom; clear it so any parent `ScrollArea` won't also scroll.
src/ui/components/diagram.rs:368:                // Compact view: static image, centered, clickable
src/ui/components/diagram.rs:402:/// Generate stable image ID
src/ui/components/diagram.rs:404:    format!("bytes://d2_diagram_{:x}.svg", diagram_key)
src/ui/components/diagram.rs:407:/// Render error state
src/ui/components/diagram.rs:469:        // Manually inject error state into memory
src/ui/components/cyber_button.rs:15:    // 1. Layout Specs
src/ui/components/cyber_button.rs:27:    // Repaint triggers for animations
src/ui/components/cyber_button.rs:46:    // --- 2. BACKGROUND & ACCENT ---
src/ui/components/cyber_button.rs:59:    // Border
src/ui/components/cyber_button.rs:72:    // --- 3. CONTENT (ICON & TEXT) ---
src/ui/components/cyber_button.rs:98:    // DRAW GEOMETRIC ICON
src/ui/components/cyber_button.rs:100:        // Rotating Reticle (Running)
src/ui/components/cyber_button.rs:114:        // Dynamic Diamond (One-shot animation on hover)
src/ui/components/cyber_button.rs:117:        // Use hover_ratio to drive a "one-shot" feel.
src/ui/components/cyber_button.rs:118:        // sin(ratio * PI) goes 0 -> 1 -> 0, creating a perfect pulse.
src/ui/components/cyber_button.rs:123:                // Reset: A satisfying 180-degree flip
src/ui/components/cyber_button.rs:126:                // Run: Professional 45-degree shift
src/ui/components/cyber_button.rs:149:        // Center dot also pulses
src/ui/components/cyber_button.rs:155:    // DRAW TEXT
src/ui/components/action_button.rs:6:/// Common action button component
src/ui/components/agent_selector.rs:47:        // 1. Draw the "ComboBox" button manually
src/ui/components/agent_selector.rs:60:        // Draw button background / border
src/ui/components/agent_selector.rs:70:        // Stroke
src/ui/components/agent_selector.rs:87:        // Draw Content (Logo + Text + Chevron)
src/ui/components/agent_selector.rs:88:        // Use less vertical shrinking to allow correct centering
src/ui/components/agent_selector.rs:94:                // Logo
src/ui/components/agent_selector.rs:98:                    let uri = format!("bytes://{}", logo_path);
src/ui/components/agent_selector.rs:106:                // Text
src/ui/components/agent_selector.rs:114:                // Spacer
src/ui/components/agent_selector.rs:132:        // 2. Draw Popup using the new Popup::show API
src/ui/components/agent_selector.rs:134:            .open_memory(None) // Don't change state here, we handle it above with toggle_id
src/ui/components/agent_selector.rs:154:                            // Selection Logic - now with proper hover detection
src/ui/components/agent_selector.rs:177:                            // Hover/Select styling
src/ui/components/agent_selector.rs:192:                            // Content - with better padding
src/ui/components/agent_selector.rs:198:                                    // Logo
src/ui/components/agent_selector.rs:202:                                        let uri = format!("bytes://{}", logo_path);
src/ui/components/agent_selector.rs:238:        // The Popup::show API handles keeping the popup open and closing on outside clicks automatically
src/ui/components/diff/mod.rs:1://! Unified diff display component for LaReview.
src/ui/components/diff/mod.rs:2://!
src/ui/components/diff/mod.rs:3://! Handles parsing, rendering, and interaction with git diffs in a unified format with syntax
src/ui/components/diff/mod.rs:4://! highlighting, inline diffs, and collapsible file sections.
src/ui/components/diff/parse.rs:1:// This file is no longer used in the new architecture, so we can remove the old types
src/ui/components/diff/parse.rs:34:// This function is kept for compatibility, but the new architecture doesn't use this approach
src/ui/components/diff/parse.rs:157:// This function is kept for compatibility with the old code that might still reference it
src/ui/components/diff/parse.rs:182:        // Determine the key for aggregation.
src/ui/components/diff/parse.rs:183:        // We use the same logic as the UI to determine the "primary" path.
src/ui/components/diff/parse.rs:191:            // Aggregate into existing entry
src/ui/components/diff/parse.rs:196:            // New entry
src/ui/components/diff/parse.rs:213:// Define the old types here so that this file can compile, but they're no longer used in the new architecture
src/ui/components/diff/parse.rs:221:    inline_segments: Option<Vec<(String, bool)>>, // (text, highlight)
src/ui/components/diff/parse.rs:240:        // A diff where the same file appears twice (simulating multiple hunks/sections for the same file)
src/ui/components/diff/parse.rs:259:        // Should be aggregated into 1 file
src/ui/components/diff/parse.rs:262:        // 1 hunk from first part, 1 hunk from second part -> total lines depends on implementation
src/ui/components/diff/parse.rs:263:        // But mainly we check file count.
src/ui/components/diff/indexer.rs:8:const CHECKPOINT_INTERVAL: u32 = 256; // Store checkpoint every N lines
src/ui/components/diff/indexer.rs:14:    // Parse files and hunks from the diff text
src/ui/components/diff/indexer.rs:21:                // Move to the line after the current file
src/ui/components/diff/indexer.rs:48:    // Parse the file header
src/ui/components/diff/indexer.rs:53:    // Look for --- and +++ lines
src/ui/components/diff/indexer.rs:60:            // Found first hunk, stop looking for file headers
src/ui/components/diff/indexer.rs:66:    // Find the end of this file section
src/ui/components/diff/indexer.rs:69:    // Parse hunks in this file section
src/ui/components/diff/indexer.rs:76:    // Process lines from file header to end of file
src/ui/components/diff/indexer.rs:127:    // Parse old and new line info from header: @@ -old_start,old_len +new_start,new_len @@
src/ui/components/diff/indexer.rs:129:        // Fall back to defaults if parsing fails so rendering still works
src/ui/components/diff/indexer.rs:132:    // Count the actual lines in the hunk body
src/ui/components/diff/indexer.rs:155:    // Create checkpoints every N lines in the hunk body
src/ui/components/diff/indexer.rs:162:        // Update line numbers based on line type
src/ui/components/diff/indexer.rs:176:            // Record the numbers for this line before advancing
src/ui/components/diff/indexer.rs:194:    // Add final checkpoint if there isn't one at the end
src/ui/components/diff/indexer.rs:208:    // Use old_len, new_len, header_line, old_start, new_start to avoid unused variable warnings
src/ui/components/diff/indexer.rs:209:    // These values from the header might differ from actual line counts
src/ui/components/diff/indexer.rs:219:    Some((hunk, body_line_count + 1)) // +1 for the header line
src/ui/components/diff/indexer.rs:227:    // Trim the leading "@@" and capture the segment before the next "@@"
src/ui/components/diff/indexer.rs:258:// Determine change type for a line
src/ui/components/diff/indexer.rs:260:    // File and hunk headers are treated as context (Equal)
src/ui/components/diff/indexer.rs:276:// Efficiently calculate old and new line numbers for a given diff line
src/ui/components/diff/indexer.rs:291:    // Find which hunk contains this line
src/ui/components/diff/indexer.rs:294:            // Find the nearest checkpoint before this line
src/ui/components/diff/indexer.rs:304:                // Calculate line numbers from the checkpoint
src/ui/components/diff/indexer.rs:308:                // Iterate from the checkpoint to the target line
src/ui/components/diff/indexer.rs:327:                // Now determine the numbers for the target line
src/ui/components/diff/indexer.rs:344:    // If we couldn't find the line in any hunk (e.g., it's a file header line)
src/ui/components/diff/doc.rs:5:    pub at_line: u32, // diff line index
src/ui/components/diff/doc.rs:12:    pub body_range: Range<u32>,       // lines inside the hunk body
src/ui/components/diff/doc.rs:13:    pub checkpoints: Vec<Checkpoint>, // every N lines
src/ui/components/diff/doc.rs:23:    // Range of diff line indices in this file, in the unified diff text.
src/ui/components/diff/doc.rs:36:    // Byte offsets for the start of each line in `text`.
src/ui/components/diff/doc.rs:37:    // Example: line i starts at text[line_starts[i]..]
src/ui/components/diff/doc.rs:40:    // Parsed files and their line ranges (in "line index" space).
src/ui/components/diff/doc.rs:57:        starts.push(0); // First line starts at 0
src/ui/components/diff/doc.rs:85:            (self.line_starts[i + 1] as usize).saturating_sub(1) // exclude '\n'
src/ui/components/diff/model.rs:1:// No imports needed for the new architecture
src/ui/components/diff/model.rs:3:/// Possible actions that can be triggered from the diff viewer.
src/ui/components/diff/model.rs:6:    /// No action was triggered.
src/ui/components/diff/model.rs:8:    /// Open the diff in full window view.
src/ui/components/diff/model.rs:10:    /// A line was clicked for commenting.
src/ui/components/diff/model.rs:11:    /// Carries the 0-based index of the line in the FileDiff structure, and the
src/ui/components/diff/model.rs:12:    /// line number in the source file (old_line_num or new_line_num).
src/ui/components/diff/model.rs:20:    /// View existing feedback items for a line.
src/ui/components/diff/model.rs:22:    /// Save a note for a line.
src/ui/components/diff/model.rs:29:    /// Open the file in an external editor at the given line.
src/ui/components/diff/model.rs:50:/// Light state stored in egui memory - only keep small UI flags here
src/ui/components/diff/model.rs:55:    pub collapsed: Vec<bool>, // Per-file collapse state - only this is stored in egui memory
src/ui/components/pills.rs:17:        // Set text colors by modifying fg_stroke.color for different states
src/ui/components/pills.rs:32:        // Don't set explicit color - let widget visuals handle it
src/ui/components/status.rs:5:/// Common status label component
src/ui/components/status.rs:11:/// Common error banner component
src/ui/components/markdown.rs:100:/// Quantize a width to the nearest step (default 40px) to reduce text re-layout frequency.
src/ui/components/markdown.rs:102:// Size limit for code block syntax highlighting (50KB)
src/ui/components/markdown.rs:103:// Large blocks can cause runaway highlighting time, so we fall back to plain text
src/ui/components/markdown.rs:104:// This prevents rendering hangs on extremely large code blocks
src/ui/components/markdown.rs:111:// --- Markdown Caching Types ---
src/ui/components/markdown.rs:237:    // Use the smaller of available width or 900px for better readability
src/ui/components/markdown.rs:381:            // Only highlight if content is reasonably sized to avoid runaway highlighting
src/ui/components/markdown.rs:382:            // Very large blocks (>50KB) fall back to plain text to prevent rendering hangs
src/ui/components/markdown.rs:383:            // Note: This trades off syntax highlighting for stability on massive code blocks
src/ui/components/markdown.rs:445:            // Use Extend mode for horizontal scroll (no wrapping)
src/ui/components/markdown.rs:446:            // This preserves layout for wide code blocks and diagrams
src/ui/components/markdown.rs:624:                // We handle spacing in render now
src/ui/components/markdown.rs:802:            // Table cells are handled in end_tag
src/ui/components/markdown.rs:804:            // If we were building up a job for a cell, we need to put it back or handle it differently
src/ui/components/markdown.rs:805:            // Actually, in `start_tag(TableCell)`, we reset job. In `end_tag(TableCell)`, we push it.
src/ui/components/markdown.rs:806:            // But if flush is called *during* a cell (e.g. hard break), we might split it?
src/ui/components/markdown.rs:807:            // Markdown tables usually don't support hard breaks or complex blocks inside cells.
src/ui/components/markdown.rs:808:            // For now, let's assume flush inside table is only happening at end of inline content
src/ui/components/markdown.rs:809:            // which should be fine if we are accumulating into one job per cell.
src/ui/components/markdown.rs:810:            // Wait, standard `flush` logic pushes to `self.items`. We don't want that for tables.
src/ui/components/markdown.rs:812:            // Revert the take if we are in table, because `end_tag` will handle it.
src/ui/components/markdown.rs:846:        // Space, Text(Heading), Space, Text(Paragraph)
src/ui/components/markdown.rs:856:                render_markdown(ui, "# Title\n\n**Bold** and *italic* and ~~strikethrough~~ and [link](https://example.com).\n\n> Blockquote\n\n- Bullet 1\n- [ ] Task 1\n\n```rust\nfn main() {}\n```");
src/ui/components/columns.rs:3:/// Three-column layout component
src/ui/components/columns.rs:28:            // Left column
src/ui/components/columns.rs:33:            // Center column
src/ui/components/columns.rs:38:            // Right column
src/ui/components/columns.rs:46:/// Two-column layout component
src/ui/components/columns.rs:68:            // Left column
src/ui/components/columns.rs:73:            // Right column
src/ui/mod.rs:1://! UI layer - GPUI components and views
src/ui/views/mod.rs:1://! Views module
src/ui/views/review/feedback_list.rs:37:    // Sort feedbacks: Open/WIP first, then by date (newest first)
src/ui/views/review/feedback_list.rs:56:                // -- Status Icon --
src/ui/views/review/feedback_list.rs:61:                // -- Title --
src/ui/views/review/feedback_list.rs:64:                // -- Metadata (Impact + Time) --
src/ui/views/review/feedback_list.rs:72:                // Create a job for the metadata with icon + label + time
src/ui/views/review/feedback_list.rs:75:                // Add impact icon
src/ui/views/review/feedback_list.rs:86:                // Add impact label
src/ui/views/review/feedback_list.rs:97:                // Add separator
src/ui/views/review/feedback_list.rs:108:                // Add time
src/ui/views/review/feedback_list.rs:121:                // -- Render Item --
src/ui/views/review/feedback_list.rs:147:                // Separator
src/ui/views/review/feedback_list.rs:150:                        // add 6.5 to make the line touch the left edge of the resize ha
src/ui/views/review/center_pane.rs:17:    /// Renders the logic for the Center Panel
src/ui/views/review/center_pane.rs:28:            // Validate selection still exists
src/ui/views/review/center_pane.rs:35:                RightPaneState::ReadyNoSelection // Fallback
src/ui/views/review/center_pane.rs:94:/// Screen shown when tasks exist but none are selected
src/ui/views/review/center_pane.rs:100:    // Safety: ensure enough width for margins
src/ui/views/review/center_pane.rs:106:    // Keyboard shortcuts logic
src/ui/views/review/center_pane.rs:120:                // Hero Icon
src/ui/views/review/center_pane.rs:137:                // Primary Action
src/ui/views/review/center_pane.rs:147:                // Hint for keyboard shortcut
src/ui/views/review/center_pane.rs:163:/// Renders the "No Tasks" empty state
src/ui/views/review/center_pane.rs:190:                    // Text Content
src/ui/views/review/center_pane.rs:201:                    // Primary CTA
src/ui/views/review/center_pane.rs:288:                // Simulate Enter key
src/ui/views/review/overlays/export.rs:42:                // Header
src/ui/views/review/overlays/export.rs:72:                // Main Body
src/ui/views/review/overlays/export.rs:87:                        // Sidebar
src/ui/views/review/overlays/export.rs:176:                        // Resize Handle
src/ui/views/review/overlays/export.rs:201:                        // Preview Area
src/ui/views/review/overlays/export.rs:239:                // Footer
src/ui/views/review/feedback/header.rs:30:    // Row 1: title only
src/ui/views/review/feedback/header.rs:70:    // Row 2: actions (left aligned)
src/ui/views/review/feedback/header.rs:75:        // Status selector
src/ui/views/review/feedback/header.rs:95:        // Impact selector
src/ui/views/review/feedback/header.rs:131:        // Delete
src/ui/views/review/feedback/context.rs:66:        // harness.get_by_label("main.rs:10"); // File header no longer rendered here
src/ui/views/review/feedback_detail.rs:75:                // Get draft key - use feedback_id if exists, otherwise synthesize from context
src/ui/views/review/feedback_detail.rs:109:                    // status/link handled in header actions row
src/ui/views/review/feedback_detail.rs:143:        // 3. Timeline & Input
src/ui/views/review/feedback_detail.rs:164:                    // 4. Input Area
src/ui/views/review/feedback_detail.rs:175:                        // Clear drafts after sending
src/ui/views/review/feedback_detail.rs:216:    // Normalize path: strip a/ or b/ prefixes
src/ui/views/review/feedback_detail.rs:224:    // Extract basename for fallback matching
src/ui/views/review/feedback_detail.rs:230:    // Check if two paths match (exact, suffix, or basename)
src/ui/views/review/feedback_detail.rs:232:        // Exact match
src/ui/views/review/feedback_detail.rs:236:        // Anchor is a suffix of diff path (e.g., "package.json" matches "libs/package.json")
src/ui/views/review/feedback_detail.rs:240:        // Diff path is a suffix of anchor (e.g., "libs/package.json" matches "package.json" in diff)
src/ui/views/review/feedback_detail.rs:244:        // Basename match as last resort
src/ui/views/review/feedback_detail.rs:320:        // File matched but line not found in any hunk - don't fall through to other files
src/ui/views/review/feedback_detail.rs:390:        // Exact match
src/ui/views/review/feedback_detail.rs:392:        // Suffix match
src/ui/views/review/feedback_detail.rs:394:        // Basename match
src/ui/views/review/feedback_detail.rs:395:        assert!(diff_snippet_for_anchor(diff, "button", 1).is_none()); // Basename match only works for full component
src/ui/views/review/mod.rs:1://! Review view module (split by feature parts).
src/ui/views/review/task/feedback_tab.rs:99:            // Metadata: status icon/label + impact icon/label + comments count
src/ui/views/review/task/feedback_tab.rs:102:            // Status
src/ui/views/review/task/feedback_tab.rs:122:            // Impact
src/ui/views/review/task/feedback_tab.rs:142:            // Count + Path
src/ui/views/review/task/tabs.rs:31:    // Force Feedback tab if feedback is active
src/ui/views/review/task/header.rs:15:    // 1. Task Title
src/ui/views/review/task/header.rs:26:    // 2. Metadata row (Status + Risk + Stats)
src/ui/views/review/task/header.rs:37:            // Status Dropdown
src/ui/views/review/task/header.rs:60:                true, // enabled
src/ui/views/review/task/header.rs:68:            // Dot Separator
src/ui/views/review/task/header.rs:69:            // ...
src/ui/views/review/task/header.rs:74:            // Risk Indicator
src/ui/views/review/task/header.rs:88:            // Dot Separator
src/ui/views/review/task/header.rs:93:            // Stats
src/ui/views/review/task/description_tab.rs:13:    // Cache key includes content hash to invalidate when content changes
src/ui/views/review/task/description_tab.rs:36:            .inner_margin(spacing::SPACING_LG) // Reduced from XL
src/ui/views/review/task/description_tab.rs:46:                        ui.spacing_mut().indent = 0.0; // Removed extra indent
src/ui/views/review/task/description_tab.rs:48:                        // Removed inner frame with large right margin
src/ui/views/review/task_detail.rs:9:    /// Renders the detailed view of the selected task
src/ui/views/review/task_detail.rs:15:        // Safety: ensure enough width for margins
src/ui/views/review/task_detail.rs:46:        // 4. Content Area
src/ui/views/review/task_detail.rs:51:                // Fetch active tab
src/ui/views/review/nav.rs:11:/// Renders the logic for the Left Panel (Navigation)
src/ui/views/review/nav.rs:108:/// Renders a single task item in the sidebar
src/ui/views/review/nav.rs:117:    // -- Status Icon --
src/ui/views/review/nav.rs:121:    // -- Title --
src/ui/views/review/nav.rs:134:    // -- Risk / Subtitle --
src/ui/views/review/view.rs:1://! Review screen (task list + task detail)
src/ui/views/review/view.rs:25:        // --- 1. Data Preparation ---
src/ui/views/review/view.rs:36:        // Count open (Pending + InProgress)
src/ui/views/review/view.rs:47:        // Find next actionable task
src/ui/views/review/view.rs:60:        // --- 2. Main Container Setup ---
src/ui/views/review/view.rs:61:        // We calculate the content area manually to handle the split view cleanly
src/ui/views/review/view.rs:68:        content_ui.set_clip_rect(content_rect); // Clip to prevent spillover
src/ui/views/review/view.rs:71:        // --- 3. Top Header (Toolbar) ---
src/ui/views/review/view.rs:80:                        // A. Left Side: Context Selectors
src/ui/views/review/view.rs:104:                        // B. Spacer
src/ui/views/review/view.rs:106:                            // C. Right Side: Actions
src/ui/views/review/view.rs:109:                            // Delete Button
src/ui/views/review/view.rs:152:                                // Export Button
src/ui/views/review/view.rs:168:                            // Progress Text (Right aligned next to actions)
src/ui/views/review/view.rs:191:        // Draw Full-Width Separator only if we have tasks or are generating
src/ui/views/review/view.rs:199:        // Handle delayed actions
src/ui/views/review/view.rs:207:        // Error Banner
src/ui/views/review/view.rs:213:        // --- 4. Content Area (Split View) ---
src/ui/views/review/view.rs:215:        // Handle "No Review" state early
src/ui/views/review/view.rs:227:        // Auto-selection logic
src/ui/views/review/view.rs:230:        // Layout Calculations
src/ui/views/review/view.rs:239:        // --- Left Panel Width ---
src/ui/views/review/view.rs:245:        // Calculate available space for sidebars after reserving center width
src/ui/views/review/view.rs:246:        // We also reserve space for resize handles (approx 16px)
src/ui/views/review/view.rs:250:        // Prioritize Left Panel
src/ui/views/review/view.rs:253:        // Determine actual visibility/width of Left Panel
src/ui/views/review/view.rs:254:        // If budget is tiny, we might hide it or squeeze center.
src/ui/views/review/view.rs:255:        // Strategy: Always show Left if at least MIN_SIDEBAR_WIDTH fits in budget.
src/ui/views/review/view.rs:259:            // If super narrow, check if we can fit it by squeezing center?
src/ui/views/review/view.rs:260:            // For now, let's just clamp to 0 if we strictly enforce center min width.
src/ui/views/review/view.rs:261:            // Or maybe we allow center to shrink if window is very small.
src/ui/views/review/view.rs:262:            // Let's stick to the plan: Hide/Collapse if it doesn't fit.
src/ui/views/review/view.rs:264:                // Allow center to go below min if needed
src/ui/views/review/view.rs:271:        // --- Right Panel Width ---
src/ui/views/review/view.rs:277:        // Calculate remaining budget for Right Panel
src/ui/views/review/view.rs:280:        // Auto-hide Right Panel if not enough space
src/ui/views/review/view.rs:281:        // We allow squeezing the center panel a bit more (down to 300px) to keep sidebars visible
src/ui/views/review/view.rs:292:        // --- Rect Definitions ---
src/ui/views/review/view.rs:317:        // Center Panel Rect
src/ui/views/review/view.rs:326:        // Min viable width check for rendering content (sanity check)
src/ui/views/review/view.rs:329:        // --- A. Left Panel (Navigation Tree) ---
src/ui/views/review/view.rs:362:        // --- Left Resize Handle ---
src/ui/views/review/view.rs:375:        // Draw Left Resize Visuals
src/ui/views/review/view.rs:394:        // --- B. Center Panel (Task Detail or Status) ---
src/ui/views/review/view.rs:410:        // --- C. Right Resize Handle ---
src/ui/views/review/view.rs:419:            // Dragging left increases width (since it's anchored right)
src/ui/views/review/view.rs:442:        // --- D. Right Panel (Feedback List) ---
src/ui/views/review/view.rs:465:                                        // Removed feedback selection toggle button
src/ui/views/review/view.rs:473:                        // Filter feedbacks for current review
src/ui/views/review/view.rs:513:        // Only enforce logic if selection is invalid or missing when it shouldn't be
src/ui/views/review/view.rs:527:            // Logic: If user was doing something, clear it. If just starting, maybe wait?
src/ui/views/review/view.rs:528:            // Current logic: clear if invalid.
src/ui/views/review/toolbar.rs:8:/// Renders the dropdowns for Review and Run selection in the header
src/ui/views/review/toolbar.rs:19:    // Find label
src/ui/views/review/toolbar.rs:27:    // Review Selector - Custom "Title" Button
src/ui/views/review/toolbar.rs:32:        // Visuals overrides
src/ui/views/review/toolbar.rs:47:        // 1. Calculate size
src/ui/views/review/toolbar.rs:54:        // 2. Allocate
src/ui/views/review/toolbar.rs:62:        // 3. Determine color
src/ui/views/review/toolbar.rs:71:        // 4. Draw
src/ui/views/review/toolbar.rs:92:                // Sort reviews: Selected first, then by date desc
src/ui/views/review/toolbar.rs:109:                    // Custom list item layout
src/ui/views/review/toolbar.rs:117:                    // Background (Only for selected when not hovered)
src/ui/views/review/toolbar.rs:122:                    // Content
src/ui/views/generate/agent_pane.rs:29:            // Integrated Control Panel
src/ui/views/generate/agent_pane.rs:31:                // 1. Configuration Row
src/ui/views/generate/agent_pane.rs:55:            // Plan Section
src/ui/views/generate/timeline_pane.rs:14:        // 1. ACTIVITY Section Header
src/ui/views/generate/timeline_pane.rs:44:        // 2. ACTIVITY Timeline (Scrollable Area)
src/ui/views/generate/timeline.rs:14:            // Internal technical logs are not rendered in the user-facing activity log
src/ui/views/generate/timeline.rs:48:            // New Design: No quotes, distinct color
src/ui/views/generate/timeline.rs:123:            // Compact status update
src/ui/views/generate/timeline.rs:163:            // Collapsed by default
src/ui/views/generate/timeline.rs:186:            // Skip internal system log: "System: Commands updated"
src/ui/views/generate/timeline.rs:189:            // Skip internal mode switch logs
src/ui/views/generate/timeline.rs:211:            let mut rt = typography::mono(&text.text).color(color).size(13.0); // Slightly larger
src/ui/views/generate/timeline.rs:290:    // Example: "return_task (lareview-tasks MCP Server): {...}"
src/ui/views/generate/timeline.rs:296:        // Normalize server: strip common suffixes like "MCP Server"
src/ui/views/generate/timeline.rs:357:            .max_col_width(ui.available_width() - 80.0) // Leave room for key column
src/ui/views/generate/timeline.rs:367:                    // Truncate very long values but allow reasonable wrapping
src/ui/views/generate/timeline.rs:384:        // Fallback for non-objects
src/ui/views/generate/timeline.rs:414:        // Technical logs should NOT be rendered
src/ui/views/generate/timeline.rs:483:        // Case 1: Simple tool
src/ui/views/generate/timeline.rs:488:        // Case 2: Tool with server in title
src/ui/views/generate/timeline.rs:493:        // Case 3: Complex title
src/ui/views/generate/plan.rs:20:        )) // 10,8 -> 12,8
src/ui/views/generate/plan.rs:48:            render_plan_entries(ui, plan, /*dense=*/ false);
src/ui/views/generate/plan.rs:84:            render_plan_entries(ui, plan, /*dense=*/ true);
src/ui/views/generate/plan.rs:94:            ui.spacing_mut().item_spacing = egui::vec2(spacing::SPACING_SM, 0.0); // 8.0, 0.0
src/ui/views/generate/plan.rs:115:            ui.add_space(2.0); // Keep 2.0 as this is specific spacing for plan entry gaps
src/ui/views/generate/input_pane.rs:16:    // 1. DETERMINE CONTENT SOURCE
src/ui/views/generate/input_pane.rs:146:        // Should show diff viewer, not text edit
src/ui/views/generate/view.rs:22:            // --- Header Section ---
src/ui/views/generate/view.rs:31:                            // A. Left Side
src/ui/views/generate/view.rs:37:                                    // C. Right Side: Actions
src/ui/views/generate/view.rs:42:                                    // 1. Run Button (Cyber style)
src/ui/views/generate/view.rs:66:                                    // 2. Stop/Clear Button (Simple Pill)
src/ui/views/generate/view.rs:94:            // --- Resizable Panes Setup ---
src/ui/views/generate/view.rs:123:            // --- RESIZE HANDLE (drawn in parent UI before clipping) ---
src/ui/views/generate/view.rs:152:            // Now create clipped child UI for content
src/ui/views/generate/view.rs:157:            // --- LEFT PANE (Smart Input) ---
src/ui/views/generate/view.rs:177:            // --- RIGHT PANE (Agent & Timeline) ---
src/ui/views/settings.rs:46:                        // A. Left Side: Context Selectors
src/ui/views/settings.rs:54:        // --- GitHub Section ---
src/ui/views/settings.rs:61:                // Title Block
src/ui/views/settings.rs:88:                // Content Block
src/ui/views/settings.rs:140:                // Troubleshooting
src/ui/views/settings.rs:176:        // --- D2 Section ---
src/ui/views/settings.rs:203:                let install_cmd = "curl -fsSL https://d2lang.com/install.sh | sh -s --";
src/ui/views/settings.rs:205:                    "curl -fsSL https://d2lang.com/install.sh | sh -s -- --uninstall";
src/ui/views/settings.rs:312:        // --- Editor Section ---
src/ui/views/settings.rs:386:        // --- Agents Section ---
src/ui/views/settings.rs:437:        // --- Modals ---
src/ui/views/settings.rs:440:        // Modals are now handled by the central overlay dispatcher in render_overlays
src/ui/views/settings.rs:460:                        // Logo
src/ui/views/settings.rs:464:                            let uri = format!("bytes://{}", logo_path);
src/ui/views/settings.rs:470:                            // Placeholder icon
src/ui/views/settings.rs:517:                    // Path/Command info
src/ui/views/settings.rs:535:                                // Take snapshot for dirty check
src/ui/views/settings.rs:1020:    /// Helper UI component for commands
src/ui/views/settings.rs:1025:            // Command text in a box
src/ui/views/settings.rs:1028:                .inner_margin(spacing::SPACING_SM) // Using SPACING_SM (8.0) as closest to 6.0
src/ui/views/settings.rs:1034:            // Copy button
src/ui/views/repos.rs:16:        // --- Header Section ---
src/ui/views/repos.rs:25:                        // A. Left Side: Context Selectors
src/ui/views/repos.rs:29:                            // C. Right Side: Actions
src/ui/views/repos.rs:50:        // --- Content Section ---
src/ui/views/repos.rs:77:                            // 1. Icon (Far Left)
src/ui/views/repos.rs:85:                            // 2. Content Column (Name, Subtitle)
src/ui/views/repos.rs:89:                                // Name
src/ui/views/repos.rs:98:                                // Subtitle (Path + Remotes)
src/ui/views/repos.rs:107:                            // 3. Actions Column (Right Aligned)
src/ui/animations/cyber.rs:14:/// A rotating reticle with configurable arms.
src/ui/animations/cyber.rs:31:/// A pulsing circle that grows and shrinks.
src/ui/animations/cyber.rs:50:/// A combined loader widget using cyber elements.
src/ui/animations/cyber.rs:59:    // 1. Rotating Reticle (Simple style from cyber_button)
src/ui/animations/cyber.rs:73:    // 2. Status Text below
src/ui/animations/cyber.rs:101:/// A smaller, inline version of the loader for lists or toolbars.
src/infra/shell.rs:9:// Marker-wrapped JSON lets us parse env output even if the shell prints noise.
src/infra/shell.rs:19:// Used by login-shell capture (`--printenv`) to return a clean env payload.
src/infra/diagram/dsl.rs:1://! Diagram modeling and rendering utilities.
src/infra/diagram/dsl.rs:2://!
src/infra/diagram/dsl.rs:3://! This module defines a neutral diagram model (flow, sequence, state, entity),
src/infra/diagram/dsl.rs:4://! rendering targets (D2 + Mermaid), validation, and JSON parsing for agents.
src/infra/diagram/dsl.rs:10:// =========================================================================
src/infra/diagram/dsl.rs:11:// Error Handling
src/infra/diagram/dsl.rs:12:// =========================================================================
src/infra/diagram/dsl.rs:14:/// Library error types.
src/infra/diagram/dsl.rs:17:    /// Edge references non-existent node.
src/infra/diagram/dsl.rs:19:    /// Group contains non-existent node.
src/infra/diagram/dsl.rs:21:    /// Duplicate node ID.
src/infra/diagram/dsl.rs:23:    /// Empty diagram.
src/infra/diagram/dsl.rs:25:    /// Invalid ID format.
src/infra/diagram/dsl.rs:27:    /// Message references non-existent actor.
src/infra/diagram/dsl.rs:29:    /// Rendering error.
src/infra/diagram/dsl.rs:31:    /// Unsupported node/actor kind
src/infra/diagram/dsl.rs:33:    /// Diagram parsing failure
src/infra/diagram/dsl.rs:61:/// Convenience result alias.
src/infra/diagram/dsl.rs:64:// =========================================================================
src/infra/diagram/dsl.rs:65:// Core Types with Styling
src/infra/diagram/dsl.rs:66:// =========================================================================
src/infra/diagram/dsl.rs:68:/// Diagram variants.
src/infra/diagram/dsl.rs:78:/// Layout direction.
src/infra/diagram/dsl.rs:122:/// Color specification.
src/infra/diagram/dsl.rs:185:/// Visual styling for nodes.
src/infra/diagram/dsl.rs:197:/// Edge styling.
src/infra/diagram/dsl.rs:206:// =========================================================================
src/infra/diagram/dsl.rs:207:// Flow Diagram
src/infra/diagram/dsl.rs:208:// =========================================================================
src/infra/diagram/dsl.rs:210:/// Flow diagram with nodes and edges.
src/infra/diagram/dsl.rs:224:/// Additional information for diagrams.
src/infra/diagram/dsl.rs:233:/// A node in a flow diagram.
src/infra/diagram/dsl.rs:244:/// Node kinds used to drive shape mapping.
src/infra/diagram/dsl.rs:289:/// A connection between nodes.
src/infra/diagram/dsl.rs:304:/// Edge kind for semantic tagging.
src/infra/diagram/dsl.rs:316:/// Grouping of nodes.
src/infra/diagram/dsl.rs:326:// =========================================================================
src/infra/diagram/dsl.rs:327:// Sequence Diagram
src/infra/diagram/dsl.rs:328:// =========================================================================
src/infra/diagram/dsl.rs:330:/// Sequence diagram definition.
src/infra/diagram/dsl.rs:340:/// Actor definition for sequence diagrams.
src/infra/diagram/dsl.rs:350:/// Actor kind used to style participants.
src/infra/diagram/dsl.rs:389:/// Sequence messages.
src/infra/diagram/dsl.rs:423:/// Note placement.
src/infra/diagram/dsl.rs:431:/// Fragment grouping (alt/opt/loop/par/etc.).
src/infra/diagram/dsl.rs:440:/// Branch inside a fragment.
src/infra/diagram/dsl.rs:449:/// Fragment kind.
src/infra/diagram/dsl.rs:461:// =========================================================================
src/infra/diagram/dsl.rs:462:// State Diagram
src/infra/diagram/dsl.rs:463:// =========================================================================
src/infra/diagram/dsl.rs:465:/// Simple state diagram.
src/infra/diagram/dsl.rs:476:/// A state in a state diagram.
src/infra/diagram/dsl.rs:485:/// Transition between states.
src/infra/diagram/dsl.rs:497:// =========================================================================
src/infra/diagram/dsl.rs:498:// Entity Diagram
src/infra/diagram/dsl.rs:499:// =========================================================================
src/infra/diagram/dsl.rs:501:/// Entity-relationship diagram.
src/infra/diagram/dsl.rs:509:/// Table/entity.
src/infra/diagram/dsl.rs:517:/// Attribute/column.
src/infra/diagram/dsl.rs:526:/// Relationship between entities.
src/infra/diagram/dsl.rs:535:/// Relationship cardinality.
src/infra/diagram/dsl.rs:545:// =========================================================================
src/infra/diagram/dsl.rs:546:// Builder Pattern (Flow only for now)
src/infra/diagram/dsl.rs:547:// =========================================================================
src/infra/diagram/dsl.rs:549:/// Builder for flow diagrams.
src/infra/diagram/dsl.rs:559:    /// Create a builder for a flow diagram.
src/infra/diagram/dsl.rs:676:// =========================================================================
src/infra/diagram/dsl.rs:677:// Validation
src/infra/diagram/dsl.rs:678:// =========================================================================
src/infra/diagram/dsl.rs:681:    /// Validate nodes, edges, and groups.
src/infra/diagram/dsl.rs:689:        // Check for duplicate IDs
src/infra/diagram/dsl.rs:699:        // Validate edges
src/infra/diagram/dsl.rs:709:        // Validate groups
src/infra/diagram/dsl.rs:726:    /// Validate actors and messages.
src/infra/diagram/dsl.rs:791:// =========================================================================
src/infra/diagram/dsl.rs:792:// Rendering
src/infra/diagram/dsl.rs:793:// =========================================================================
src/infra/diagram/dsl.rs:795:/// Renderer trait.
src/infra/diagram/dsl.rs:800:/// Render diagrams to D2.
src/infra/diagram/dsl.rs:802:/// Render diagrams to Mermaid.
src/infra/diagram/dsl.rs:827:// --- Flow -> D2 ---
src/infra/diagram/dsl.rs:889:// --- Flow -> Mermaid ---
src/infra/diagram/dsl.rs:966:// --- Sequence -> D2 ---
src/infra/diagram/dsl.rs:1035:                // D2 doesn't support spanning notes in sequence diagrams natively yet.
src/infra/diagram/dsl.rs:1036:                // We attach the note to the first actor as a fallback to avoid creating
src/infra/diagram/dsl.rs:1037:                // a phantom participant named "note over ...".
src/infra/diagram/dsl.rs:1099:// --- Sequence -> Mermaid ---
src/infra/diagram/dsl.rs:1232:// --- State -> Mermaid ---
src/infra/diagram/dsl.rs:1291:// --- Entity -> Mermaid ---
src/infra/diagram/dsl.rs:1367:// =========================================================================
src/infra/diagram/dsl.rs:1368:// JSON Parsing helpers
src/infra/diagram/dsl.rs:1369:// =========================================================================
src/infra/diagram/dsl.rs:1371:/// Parse JSON text into a Diagram.
src/infra/diagram/dsl.rs:1399:// =========================================================================
src/infra/diagram/dsl.rs:1400:// Helpers
src/infra/diagram/dsl.rs:1401:// =========================================================================
src/infra/diagram/dsl.rs:1493:// =========================================================================
src/infra/diagram/dsl.rs:1494:// Tests
src/infra/diagram/dsl.rs:1495:// =========================================================================
src/infra/diagram/d2.rs:12:    // Input from stdin, output to stdout
src/infra/diagram/d2.rs:16:    // Set theme based on mode
src/infra/diagram/d2.rs:18:        command.arg("--theme").arg("200"); // Dark Mauve theme
src/infra/diagram/d2.rs:20:        command.arg("--theme").arg("0"); // Default light theme
src/infra/diagram/d2.rs:53:    // Input from stdin, output to stdout
src/infra/diagram/d2.rs:57:    // Set theme based on mode
src/infra/diagram/d2.rs:59:        command.arg("--theme").arg("200"); // Dark Mauve theme
src/infra/diagram/d2.rs:61:        command.arg("--theme").arg("0"); // Default light theme
src/infra/diagram/d2.rs:77:    drop(stdin); // Close stdin to signal EOF
src/infra/diagram/d2.rs:97:    // Input from stdin, output to stdout
src/infra/diagram/d2.rs:134:    // Input from stdin, output to stdout
src/infra/diagram/d2.rs:154:    drop(stdin); // Close stdin to signal EOF
src/infra/diagram/d2.rs:167:/// Validate D2 code by compiling it with `d2`.
src/infra/diagram/d2.rs:168:/// Returns Ok(()) if valid or if d2 is not installed (skip validation).
src/infra/diagram/d2.rs:169:/// Returns Err(msg) if d2 is installed and validation fails.
src/infra/diagram/d2.rs:172:        return Ok(()); // Skip validation if d2 is not installed
src/infra/diagram/d2.rs:176:    // Compile to ensure semantic validation (unknown shapes, etc).
src/infra/diagram/d2.rs:182:        .stdout(Stdio::null()) // We don't need rendered output
src/infra/diagram/d2.rs:183:        .stderr(Stdio::piped()) // We want errors
src/infra/diagram/d2.rs:199:        // Capture stderr for the error message
src/infra/diagram/d2.rs:201:        // If stderr is empty (sometimes happens with fmt check?), try to be helpful
src/infra/diagram/d2.rs:226:            let invalid_code = "x -> {"; // Unclosed brace
src/infra/diff/index.rs:1://! A module for indexing and querying unified diffs.
src/infra/diff/index.rs:2://!
src/infra/diff/index.rs:3://! This module provides a `DiffIndex` that can be created from a unified diff string.
src/infra/diff/index.rs:4://! The index allows for efficient querying of diff statistics and reconstruction of
src/infra/diff/index.rs:5://! partial diffs based on `DiffRef` pointers.
src/infra/diff/index.rs:13:// serde_json is used for error serialization
src/infra/diff/index.rs:18:/// Errors that can occur when working with DiffIndex
src/infra/diff/index.rs:21:    /// File not found in the diff index
src/infra/diff/index.rs:23:    /// Hunk not found in a file
src/infra/diff/index.rs:29:    /// Invalid hunk ID format
src/infra/diff/index.rs:31:    /// Parse error when processing the diff
src/infra/diff/index.rs:33:    /// Nearest hunk information when a hunk is not found
src/infra/diff/index.rs:84:    /// Convert the error to a JSON string representation
src/infra/diff/index.rs:89:    /// Get the nearest hunk coordinates if this error contains them
src/infra/diff/index.rs:98:/// A hunk with its coordinates and potentially an ID
src/infra/diff/index.rs:102:    /// The coordinates of the hunk (old_start, new_start)
src/infra/diff/index.rs:106:/// An index for a single file within a larger diff.
src/infra/diff/index.rs:109:    /// A map from (old_start, new_start) to the indexed hunk.
src/infra/diff/index.rs:111:    /// A list of all available hunks in order.
src/infra/diff/index.rs:115:/// An index for a unified diff, allowing for efficient queries.
src/infra/diff/index.rs:122:    /// Creates a new `DiffIndex` from a unified diff string.
src/infra/diff/index.rs:152:            // Convert file path to a safe identifier format for use in IDs
src/infra/diff/index.rs:157:                // Create a hunk ID that's descriptive based on file and sequential index
src/infra/diff/index.rs:158:                // Format: file_path#Hn where n is the sequential hunk number in the file (1-indexed)
src/infra/diff/index.rs:177:    /// Calculates the total number of additions and deletions for a set of `DiffRef`s.
src/infra/diff/index.rs:195:                        // Find the nearest hunk for better error reporting
src/infra/diff/index.rs:220:    /// Checks if a hunk exists in the specified file.
src/infra/diff/index.rs:233:                // Find the nearest hunk for better error reporting
src/infra/diff/index.rs:249:    /// Checks if a file exists in the diff index.
src/infra/diff/index.rs:261:    /// Generate a manifest of all hunks with their coordinates.
src/infra/diff/index.rs:262:    /// This helps agents reference hunks accurately by providing exact coordinates to copy.
src/infra/diff/index.rs:266:        // Sort files for consistent ordering
src/infra/diff/index.rs:282:                // Count additions and deletions in this hunk
src/infra/diff/index.rs:309:    /// Generate a JSON manifest of all hunks with their coordinates.
src/infra/diff/index.rs:310:    /// This is machine-readable and can be copied directly into diff_refs.hunks.
src/infra/diff/index.rs:341:    /// Renders a unified diff snippet for the given `DiffRef`s.
src/infra/diff/index.rs:342:    /// Returns the diff string and a list of ordered file paths.
src/infra/diff/index.rs:355:            // Build the header for this file
src/infra/diff/index.rs:363:                // If hunks are empty, render all available hunks for the file
src/infra/diff/index.rs:370:                // Otherwise, render only the specified hunks
src/infra/diff/index.rs:377:                            // Find the nearest hunk for better error reporting
src/infra/diff/index.rs:407:/// Helper function to find the nearest hunk to the given coordinates
src/infra/diff/index.rs:418:        // Calculate a simple distance metric
src/infra/diff/index.rs:498:        assert_eq!(additions, 4); // 1 in main.rs, 3 in lib.rs
src/infra/diff/index.rs:499:        assert_eq!(deletions, 1); // 1 in main.rs
src/infra/mod.rs:1://! Infrastructure layer (adapters/implementations).
src/infra/mod.rs:2://!
src/infra/mod.rs:3://! This module contains IO-heavy integrations (SQLite, ACP, filesystem).
src/infra/mod.rs:15:/// Normalizes escaped or literal newlines to standard \n.
src/infra/app_config.rs:121:        // Manual save using our path
src/infra/app_config.rs:125:        // Test loading
src/infra/app_config.rs:148:        // Test saving
src/infra/vcs/git.rs:4:/// Extract remote URLs from a git repository
src/infra/vcs/git.rs:37:        // Not a git repo, or at least no remotes
src/infra/vcs/git.rs:47:        // Initialize a git repo and add a remote
src/infra/vcs/git.rs:54:            return; // Skip if git is not installed or failed
src/infra/vcs/git.rs:62:                "https://github.com/example/repo.git",
src/infra/vcs/git.rs:70:        assert_eq!(remotes[0], "https://github.com/example/repo.git");
src/infra/vcs/github.rs:39:        Regex::new(r"^https?://(?:www\.)?github\.com/([^/]+)/([^/]+)/pull/(\d+)")
src/infra/vcs/github.rs:51:        let url = format!("https://github.com/{owner}/{repo}/pull/{number}");
src/infra/vcs/github.rs:64:        let url = format!("https://github.com/{owner}/{repo}/pull/{number}");
src/infra/vcs/github.rs:139:/// Post a single review comment at a diff position. This creates a review thread automatically.
src/infra/vcs/github.rs:210:/// Create a PR review with a single overall comment.
src/infra/vcs/github.rs:281:        let input = "https://github.com/puemos/lareview/pull/123";
src/infra/vcs/github.rs:300:        assert!(parse_pr_ref("https://google.com").is_none());
src/infra/db/repository/review.rs:5:/// Repository for review operations.
src/infra/db/repository/task.rs:8:/// Repository for task operations.
src/infra/db/repository/task.rs:257:    #[allow(dead_code)] // Used by ACP modules; invoked indirectly.
src/infra/db/repository/mod.rs:1://! Repository implementations for data access in LaReview.
src/infra/db/repository/mod.rs:2://!
src/infra/db/repository/mod.rs:3://! Provides database operations for reviews, runs, tasks, feedback, and comments.
src/infra/db/repository/review_run.rs:5:/// Repository for review run operations.
src/infra/db/repository/tests.rs:77:        remotes: vec!["https://github.com/test/repo".into()],
src/infra/db/repository/repo.rs:26:        // Delete existing remotes for this repo
src/infra/db/repository/repo.rs:29:        // Insert new remotes
src/infra/db/repository/repo.rs:56:            // Fetch remotes for this repo
src/infra/db/repository/repo.rs:90:            // Reuse find_all-like logic but for a single ID
src/infra/db/database.rs:1://! SQLite database setup and connection management for LaReview
src/infra/db/database.rs:2://! Handles database initialization, schema creation, and connection management.
src/infra/db/database.rs:9:/// Database wrapper that manages SQLite connections
src/infra/db/database.rs:15:    /// Create or open the database at the default location
src/infra/db/database.rs:21:    /// Create an in-memory database (useful for testing)
src/infra/db/database.rs:31:    /// Create or open the database at a specific path
src/infra/db/database.rs:33:        // Ensure parent directory exists
src/infra/db/database.rs:44:        // Expose chosen path for downstream consumers (ACP worker) if not already set
src/infra/db/database.rs:46:            // set_var is currently unsafe on nightly; this is limited to process-local config.
src/infra/db/database.rs:54:    /// Get the default database path
src/infra/db/database.rs:98:    /// Initialize database schema
src/infra/db/database.rs:109:            // Fresh database - skip migrations and go directly to current version
src/infra/db/database.rs:113:            // Existing database - run migrations to bring it up to date
src/infra/db/database.rs:123:    /// Get a reference to the connection
src/infra/db/database.rs:261:    /// Run a migration by loading and executing the corresponding SQL file
src/infra/db/database.rs:263:        // Migration files are expected to be in migrations/ folder at the project root
src/infra/db/database.rs:264:        // with naming pattern: {version:04}_description.sql
src/infra/db/database.rs:266:        // Find the migration file for this version
src/infra/db/database.rs:271:                // Try relative to executable first (for installed builds)
src/infra/db/database.rs:276:                    // Fall back to workspace root for development
src/infra/db/database.rs:284:        // Find migration file matching this version
src/infra/db/database.rs:305:        // Read and execute the migration SQL
src/infra/db/database.rs:337:        // 1. Create a v9 database manually
src/infra/db/database.rs:340:        // Create legacy v9-style tables
src/infra/db/database.rs:396:        // Insert legacy data
src/infra/db/database.rs:427:        // 2. Trigger migration to v10
src/infra/db/database.rs:428:        // (In a real app this happens in init() called by open())
src/infra/db/database.rs:431:        // 3. Verify data moved to feedback and columns renamed
src/infra/db/database.rs:434:        // Check feedback table
src/infra/db/database.rs:447:        // Check feedback_links table
src/infra/db/database.rs:457:        // Check comments table (column renamed)
src/infra/db/database.rs:467:        // Check threads table dropped
src/infra/db/database.rs:477:        // Check thread_links table dropped
src/infra/db/mod.rs:1://! SQLite persistence (infrastructure).
src/infra/acp/agents/gemini.rs:1://! Gemini ACP agent implementation
src/infra/acp/agents/opencode.rs:1://! OpenCode ACP agent implementation
src/infra/acp/agents/claude.rs:1://! Claude ACP agent implementation
src/infra/acp/agents/mistral.rs:1://! Mistral ACP agent implementation
src/infra/acp/agents/codex.rs:1://! Codex ACP agent implementation
src/infra/acp/agents/codex.rs:5:// Check if a command is available in PATH
src/infra/acp/agents/codex.rs:10:/// Build the Codex candidate, allowing overrides for binary/package.
src/infra/acp/agents/codex.rs:39:// Implement the ACP Agent trait for codex agent
src/infra/acp/agents/mod.rs:1://! ACP agents module - one file per agent
src/infra/acp/agents/mod.rs:60:        // "ls" is usually available on all systems we test on
src/infra/acp/agents/qwen.rs:1://! Qwen ACP agent implementation
src/infra/acp/agents/kimi.rs:1://! Kimi ACP agent implementation
src/infra/acp/mod.rs:1://! ACP (Agent Client Protocol) integration
src/infra/acp/agent_trait.rs:1://! Agent trait definitions
src/infra/acp/agent_trait.rs:5:/// Trait that each agent should implement to provide metadata
src/infra/acp/agent_trait.rs:7:    /// The unique ID of the agent (e.g., "codex", "qwen", "gemini")
src/infra/acp/agent_trait.rs:11:    /// Human-readable display name for the agent
src/infra/acp/agent_trait.rs:15:    /// Get the agent candidate
src/infra/acp/agent_trait.rs:18:    /// Check if the agent is available
src/infra/acp/agent_trait.rs:23:/// Agent registry that collects all available agents
src/infra/acp/agent_trait.rs:59:        // Register all known agents
src/infra/acp/agent_discovery.rs:1://! Agent discovery module for LaReview
src/infra/acp/agent_discovery.rs:2://! Detects and manages available ACP (Agent Client Protocol) agents such as Codex, Qwen, Gemini, and Mistral ACP-Vibe.
src/infra/acp/agent_discovery.rs:7:/// Information about a discoverable ACP agent
src/infra/acp/agent_discovery.rs:10:    /// Unique identifier for the agent (e.g., "codex", "qwen", "gemini")
src/infra/acp/agent_discovery.rs:12:    /// User-friendly display name for the agent
src/infra/acp/agent_discovery.rs:14:    /// Path to the agent's logo
src/infra/acp/agent_discovery.rs:16:    /// Command to execute the agent, if available
src/infra/acp/agent_discovery.rs:18:    /// Arguments to pass to the agent command
src/infra/acp/agent_discovery.rs:20:    /// Whether the agent is available and can be executed
src/infra/acp/agent_discovery.rs:24:// Cache for agent candidates with timestamp to allow refresh
src/infra/acp/agent_discovery.rs:35:const CACHE_TTL: std::time::Duration = std::time::Duration::from_secs(30); // 30 seconds
src/infra/acp/agent_discovery.rs:37:/// Get a list of all known ACP agent candidates with their availability status
src/infra/acp/agent_discovery.rs:38:/// Uses a cached AgentRegistry to avoid recreating it on each call, with TTL
src/infra/acp/agent_discovery.rs:43:    // Check if cache is valid (not expired and config hasn't changed)
src/infra/acp/agent_discovery.rs:46:        // Simple heuristic: check if custom agents count or overrides count changed
src/infra/acp/agent_discovery.rs:54:    // Cache is expired or doesn't exist, rebuild it
src/infra/acp/agent_discovery.rs:56:    // 1. Apply environment variables from config before discovery
src/infra/acp/agent_discovery.rs:57:    // Note: This modifies the process environment, which built-in agents read.
src/infra/acp/agent_discovery.rs:60:            // Built-in agents often use AGENT_ID_ACP_BIN etc.
src/infra/acp/agent_discovery.rs:61:            // We set them globally so built-in agents find them.
src/infra/acp/agent_discovery.rs:75:    // 2. Apply path overrides for built-in agents
src/infra/acp/agent_discovery.rs:83:    // 3. Add custom agents
src/infra/acp/agent_discovery.rs:121:        // Should resolve to full path if available
src/infra/acp/agent_discovery.rs:148:        // Invalidate cache by forcing an update (or just waiting, but let's clear it)
src/infra/acp/agent_discovery.rs:159:        // Cleanup
src/infra/acp/task_mcp_server/task_ingest.rs:11:/// Validate raw hunk objects before parsing so we fail fast on malformed payloads.
src/infra/acp/task_mcp_server/task_ingest.rs:120:    // Fail fast on malformed hunks to avoid silently changing scope.
src/infra/acp/task_mcp_server/task_ingest.rs:128:    // Ensure the review run exists in the database before saving the task
src/infra/acp/task_mcp_server/task_ingest.rs:142:    // Also ensure the parent review exists. `save` is non-destructive.
src/infra/acp/task_mcp_server/task_ingest.rs:150:        summary: None, // Always start with no summary; it's added by finalize_review
src/infra/acp/task_mcp_server/task_ingest.rs:163:    // Always update the active run and updated_at timestamp
src/infra/acp/task_mcp_server/task_ingest.rs:179:    // Always set files from the provided diff_refs
src/infra/acp/task_mcp_server/task_ingest.rs:219:    // Ensure the review exists by saving a placeholder. `save` is non-destructive.
src/infra/acp/task_mcp_server/task_ingest.rs:237:    // Fetch the review's current title if a new one isn't provided
src/infra/acp/task_mcp_server/task_ingest.rs:247:    // Update the review with the new metadata
src/infra/acp/task_mcp_server/task_ingest.rs:332:        // Should bail because of a/ prefix
src/infra/acp/task_mcp_server/parsing.rs:36:// Support legacy diffs field for backward compatibility
src/infra/acp/task_mcp_server/parsing.rs:64:// Extract files from diff_refs
src/infra/acp/task_mcp_server/parsing.rs:103:            // Try to find the outermost object that looks like a task
src/infra/acp/task_mcp_server/parsing.rs:122:                            // Check if it has required fields for a task
src/infra/acp/task_mcp_server/parsing.rs:135:    // If it already looks like a task with required fields, return it
src/infra/acp/task_mcp_server/parsing.rs:140:    // Try to extract from params or arguments
src/infra/acp/task_mcp_server/parsing.rs:172:    // Determine which field to use: diff_refs takes precedence, fall back to diffs
src/infra/acp/task_mcp_server/parsing.rs:180:        // If we have diff_refs, we'd need to calculate from the actual diff text using the diff index
src/infra/acp/task_mcp_server/parsing.rs:181:        // For now, we'll fall back to the legacy calculation if diffs exist
src/infra/acp/task_mcp_server/parsing.rs:185:            (0, 0) // Placeholder values that will be recomputed later
src/infra/acp/task_mcp_server/parsing.rs:193:    // Validate JSON by parsing, surface clear error
src/infra/acp/task_mcp_server/parsing.rs:200:        run_id: String::new(), // set in persistence
src/infra/acp/task_mcp_server/parsing.rs:225:    // Strip wrapping markdown code blocks if present
src/infra/acp/task_mcp_server/parsing.rs:226:    // e.g. ```d2 ... ``` or ``` ... ```
src/infra/acp/task_mcp_server/parsing.rs:236:        // Remove first and last lines
src/infra/acp/task_mcp_server/parsing.rs:257:        // Case 1: Clean code stays clean
src/infra/acp/task_mcp_server/parsing.rs:264:        // Case 2: Markdown block with language
src/infra/acp/task_mcp_server/parsing.rs:273:        // Case 3: Markdown block without language
src/infra/acp/task_mcp_server/parsing.rs:282:        // Case 4: Empty block
src/infra/acp/task_mcp_server/parsing.rs:286:        // Case 5: Empty string
src/infra/acp/task_mcp_server/parsing.rs:289:        // Case 6: Whitespace only
src/infra/acp/task_mcp_server/config.rs:3:/// Configuration for the MCP server, parsed from CLI arguments.
src/infra/acp/task_mcp_server/config.rs:6:    /// Optional path to write tasks JSON output.
src/infra/acp/task_mcp_server/config.rs:8:    /// Optional path for debug log file.
src/infra/acp/task_mcp_server/config.rs:10:    /// Optional path to review/run context JSON file.
src/infra/acp/task_mcp_server/config.rs:12:    /// Optional repo root for read-only tooling (search).
src/infra/acp/task_mcp_server/config.rs:14:    /// Optional database path override.
src/infra/acp/task_mcp_server/config.rs:19:    /// Parse server configuration from command-line arguments.
src/infra/acp/task_mcp_server/config.rs:25:    /// Parse server configuration from an iterator of strings.
src/infra/acp/task_mcp_server/transport.rs:31:        // Log outbound messages for full request/response visibility.
src/infra/acp/task_mcp_server/transport.rs:67:        // Log every inbound message for debugging failed tool calls (schema validation, etc).
src/infra/acp/task_mcp_server/logging.rs:37:/// Lightweight logging for protocol debugging; does not require config.
src/infra/acp/task_mcp_server/comment_ingest.rs:27:    // Validate body is not empty or just whitespace
src/infra/acp/task_mcp_server/comment_ingest.rs:37:            // Default title from body (truncated)
src/infra/acp/task_mcp_server/comment_ingest.rs:72:    // 1. Validate File and Line exist in Diff
src/infra/acp/task_mcp_server/comment_ingest.rs:76:    // 2. Link Task
src/infra/acp/task_mcp_server/comment_ingest.rs:78:        // Verify provided task ID exists
src/infra/acp/task_mcp_server/comment_ingest.rs:79:        // We can't easily check if ID exists without a query, but let's assume if the agent
src/infra/acp/task_mcp_server/comment_ingest.rs:80:        // provided it, they mean it. Ideally we should verify it belongs to this run.
src/infra/acp/task_mcp_server/comment_ingest.rs:81:        // For strictness, let's verify it matches the run.
src/infra/acp/task_mcp_server/comment_ingest.rs:88:        // Auto-link
src/infra/acp/task_mcp_server/comment_ingest.rs:98:            // Ambiguous: pick the first one (or arguably the smallest one, but first is deterministic enough)
src/infra/acp/task_mcp_server/comment_ingest.rs:125:            hunk_ref: None, // Inferred by UI later or left empty
src/infra/acp/task_mcp_server/comment_ingest.rs:155:    // 1. Check file exists
src/infra/acp/task_mcp_server/comment_ingest.rs:160:    // 2. Check line is within some hunk
src/infra/acp/task_mcp_server/comment_ingest.rs:161:    // This requires exposing inner logic of DiffIndex or re-parsing here.
src/infra/acp/task_mcp_server/comment_ingest.rs:162:    // Since DiffIndex struct fields are private in external crate but we are in the same workspace,
src/infra/acp/task_mcp_server/comment_ingest.rs:163:    // we might not have access to `files` map if it's not pub.
src/infra/acp/task_mcp_server/comment_ingest.rs:164:    // Checking `src/infra/diff_index.rs`, `files` is private.
src/infra/acp/task_mcp_server/comment_ingest.rs:165:    // However, we can construct a dummy `DiffRef` for the whole file and assume if it passes validation it's fine?
src/infra/acp/task_mcp_server/comment_ingest.rs:166:    // No, we need line-level validation.
src/infra/acp/task_mcp_server/comment_ingest.rs:168:    // Hack: We can't easily access private fields of DiffIndex from here without modifying DiffIndex.
src/infra/acp/task_mcp_server/comment_ingest.rs:169:    // For now, let's skip strict *line* validation against the diff index internal structure unless we modify DiffIndex.
src/infra/acp/task_mcp_server/comment_ingest.rs:170:    // But we CAN check if the line is plausible by trying to create a HunkRef? No.
src/infra/acp/task_mcp_server/comment_ingest.rs:172:    // Better: Modify DiffIndex to expose `validate_line_exists(file, line, side)`.
src/infra/acp/task_mcp_server/comment_ingest.rs:173:    // Since I cannot modify DiffIndex in this step easily without jumping back, I will implement a basic check
src/infra/acp/task_mcp_server/comment_ingest.rs:174:    // using `unidiff` directly here if needed, OR assume that if the file exists, we trust the agent on the line
src/infra/acp/task_mcp_server/comment_ingest.rs:175:    // UNLESS we want to be very strict. The user requested strictness.
src/infra/acp/task_mcp_server/comment_ingest.rs:177:    // Let's rely on the task coverage check to catch "out of bounds" errors effectively.
src/infra/acp/task_mcp_server/comment_ingest.rs:178:    // If a line is not in any task, and tasks cover the diff, then the line is likely not in the diff (or ignored).
src/infra/acp/task_mcp_server/comment_ingest.rs:179:    // So `is_line_covered_by_task` acts as a validator too.
src/infra/acp/task_mcp_server/comment_ingest.rs:190:    // 1. Check if file matches
src/infra/acp/task_mcp_server/comment_ingest.rs:195:    // 2. Check if line is contained in diff_refs
src/infra/acp/task_mcp_server/comment_ingest.rs:201:        // If no hunks specified (empty list), it means "all hunks in file".
src/infra/acp/task_mcp_server/comment_ingest.rs:202:        // In that case, we assume it covers the file.
src/infra/acp/task_mcp_server/comment_ingest.rs:203:        // However, we should technically check if the line is in *any* hunk of the file.
src/infra/acp/task_mcp_server/comment_ingest.rs:204:        // But for "empty array = select all", we usually treat it as valid.
src/infra/acp/task_mcp_server/tool.rs:22:/// Create the return_task tool for streaming task submission.
src/infra/acp/task_mcp_server/tool.rs:49:                        // Append the task as a JSON line to support streaming
src/infra/acp/task_mcp_server/tool.rs:74:                    // Log the full error chain for better debugging
src/infra/acp/task_mcp_server/tool.rs:79:                    // Check if this is a DiffIndexError and format appropriately
src/infra/acp/task_mcp_server/tool.rs:81:                        // Return structured JSON error for agent parsing
src/infra/acp/task_mcp_server/tool.rs:110:/// Create the finalize_review tool for finalizing the review.
src/infra/acp/task_mcp_server/tool.rs:120:            let persist_args_for_spawn = persist_args.clone(); // Clone before moving into spawn
src/infra/acp/task_mcp_server/tool.rs:139:                        // Append the metadata as a final record
src/infra/acp/task_mcp_server/tool.rs:165:                    // Log the full error chain for better debugging
src/infra/acp/task_mcp_server/tool.rs:170:                    // Check if this is a DiffIndexError and format appropriately
src/infra/acp/task_mcp_server/tool.rs:172:                        // Return structured JSON error for agent parsing
src/infra/acp/task_mcp_server/tool.rs:199:/// Create the add_feedback tool for submitting inline feedback.
src/infra/acp/task_mcp_server/tool.rs:891:        // Path outside root
src/infra/acp/task_mcp_server/tool.rs:893:        // Missing path
src/infra/acp/task_mcp_server/mod.rs:1://! Minimal MCP server that exposes streaming `return_task` and `finalize_review` tools.
src/infra/acp/task_mcp_server/mod.rs:2://!
src/infra/acp/task_mcp_server/mod.rs:3://! The server accepts individual tasks via `return_task` then finalizes with `finalize_review`.
src/infra/acp/task_mcp_server/mod.rs:4://! It also supports legacy bulk tools for backward compatibility.
src/infra/acp/task_mcp_server/mod.rs:5://! The server runs over stdio so the ACP agent can launch it as an MCP server.
src/infra/acp/task_mcp_server/mod.rs:25:/// Run the MCP server over stdio. Blocks until the process is terminated.
src/infra/acp/task_mcp_server/mod.rs:34:        // New streaming tools
src/infra/acp/task_mcp_server/tests.rs:6:// Mutex to ensure database tests run sequentially since they share global state via environment variables
src/infra/acp/task_mcp_server/tests.rs:12:    // Acquire lock for the duration of the test
src/infra/acp/task_mcp_server/tests.rs:17:    // Set the database path so Database::open() uses our temp path
src/infra/acp/task_mcp_server/tests.rs:18:    // Save original value to restore later
src/infra/acp/task_mcp_server/tests.rs:80:    // Read and check that task was written as JSONL
src/infra/acp/task_mcp_server/tests.rs:83:    assert_eq!(lines.len(), 1); // One task written as JSONL
src/infra/acp/task_mcp_server/tests.rs:87:    // Restore original env var
src/infra/acp/task_mcp_server/tests.rs:102:    // Acquire lock for the duration of the test
src/infra/acp/task_mcp_server/tests.rs:108:    // Set the database path so Database::open() uses our temp path
src/infra/acp/task_mcp_server/tests.rs:109:    // Save original value to restore later
src/infra/acp/task_mcp_server/tests.rs:178:    // Restore original env var
src/infra/acp/task_mcp_server/tests.rs:193:    // Acquire lock for the duration of the test
src/infra/acp/task_mcp_server/tests.rs:198:    // Set the database path so Database::open() uses our temp path
src/infra/acp/task_mcp_server/tests.rs:199:    // Save original value to restore later
src/infra/acp/task_mcp_server/tests.rs:233:    // Restore original env var
src/infra/acp/task_mcp_server/tests.rs:248:    // Acquire lock for the duration of the test
src/infra/acp/task_mcp_server/tests.rs:254:    // Set the database path so Database::open() uses our temp path
src/infra/acp/task_mcp_server/tests.rs:255:    // Save original value to restore later
src/infra/acp/task_mcp_server/tests.rs:284:    // --- Call 1 ---
src/infra/acp/task_mcp_server/tests.rs:316:    // --- Call 2 ---
src/infra/acp/task_mcp_server/tests.rs:348:    // --- Verify both tasks are saved ---
src/infra/acp/task_mcp_server/tests.rs:358:    // --- Finalize the review ---
src/infra/acp/task_mcp_server/tests.rs:374:    // --- Re-verify tasks and check review metadata ---
src/infra/acp/task_mcp_server/tests.rs:391:    // Restore original env var
src/infra/acp/task_mcp_server/tests.rs:408:    // Create some files
src/infra/acp/task_mcp_server/tests.rs:526:    // First, create a review and run and task so auto-linking works and FKs are happy
src/infra/acp/task_mcp_server/tests.rs:648:    // Should fail because no task covers this line
src/infra/acp/task_mcp_server/run_context.rs:4:/// Context provided by the UI/runtime to the MCP server so it can persist review output.
src/infra/acp/task_generator/types.rs:5:/// Input parameters for task generation.
src/infra/acp/task_generator/types.rs:7:    /// Review/run context for the task generation (also persisted by the MCP server).
src/infra/acp/task_generator/types.rs:9:    /// Optional repository root for read-only context.
src/infra/acp/task_generator/types.rs:10:    ///
src/infra/acp/task_generator/types.rs:11:    /// When this is None, the agent must operate diff-only without filesystem or terminal access.
src/infra/acp/task_generator/types.rs:12:    /// When Some, the agent may read files under this root for context only.
src/infra/acp/task_generator/types.rs:14:    /// Command to execute the ACP agent.
src/infra/acp/task_generator/types.rs:16:    /// Arguments to pass to the ACP agent command.
src/infra/acp/task_generator/types.rs:18:    /// Optional channel to send progress updates during generation.
src/infra/acp/task_generator/types.rs:20:    /// Override for MCP server binary path.
src/infra/acp/task_generator/types.rs:22:    /// Timeout in seconds for agent execution.
src/infra/acp/task_generator/types.rs:24:    /// Optional cancellation token to stop the agent.
src/infra/acp/task_generator/types.rs:26:    /// Enable debug logging.
src/infra/acp/task_generator/types.rs:30:/// Result of task generation.
src/infra/acp/task_generator/types.rs:38:/// Different types of progress updates that can be streamed from the agent.
src/infra/acp/task_generator/types.rs:41:    /// Raw ACP session update, streamed to the UI.
src/infra/acp/task_generator/types.rs:43:    /// Local log output from the ACP worker/process.
src/infra/acp/task_generator/types.rs:45:    /// Signal that the agent has finished its work (received finalize_review).
src/infra/acp/task_generator/types.rs:47:    /// A new task is being generated.
src/infra/acp/task_generator/types.rs:49:    /// A new task has been successfully persisted by the MCP server.
src/infra/acp/task_generator/types.rs:51:    /// A new comment has been successfully persisted by the MCP server.
src/infra/acp/task_generator/types.rs:53:    /// Review metadata (title/summary) has been updated by the MCP server.
src/infra/acp/task_generator/client.rs:41:/// Client implementation for receiving agent callbacks.
src/infra/acp/task_generator/client.rs:45:    pub(super) tasks: Arc<Mutex<Vec<ReviewTask>>>, // Changed to accumulate tasks
src/infra/acp/task_generator/client.rs:46:    pub(super) finalization_received: Arc<Mutex<bool>>, // Track if finalize_review was called
src/infra/acp/task_generator/client.rs:61:            // Accept single task payload if it has id and diff_refs (and likely title)
src/infra/acp/task_generator/client.rs:65:            // Accept finalize payload if it has title
src/infra/acp/task_generator/client.rs:69:            // Keep supporting plans for compatibility
src/infra/acp/task_generator/client.rs:73:            // For backward compatibility, still accept bulk tasks
src/infra/acp/task_generator/client.rs:170:            tasks: Arc::new(Mutex::new(Vec::new())), // Changed to accumulate tasks
src/infra/acp/task_generator/client.rs:171:            finalization_received: Arc::new(Mutex::new(false)), // Track if finalize_review was called
src/infra/acp/task_generator/client.rs:183:    /// Attempt to append a single task from JSON value (for return_task).
src/infra/acp/task_generator/client.rs:192:                // Don't store raw payload for streaming - validation now works from task objects
src/infra/acp/task_generator/client.rs:227:    /// Mark finalization as received.
src/infra/acp/task_generator/client.rs:373:    /// Handle task submission via extension payloads.
src/infra/acp/task_generator/client.rs:384:            // For finalize_review, we don't need to do anything special, just note that it was received
src/infra/acp/task_generator/client.rs:454:        // Check if this looks like a return tool by checking tool name or if it's JSON in title that looks like a task/finalize payload
src/infra/acp/task_generator/client.rs:461:                // For ToolKind::Other, check if the title is JSON with required streaming fields
src/infra/acp/task_generator/client.rs:465:                            // Check if it's a single task (has id and diff_refs) or finalize review (has title)
src/infra/acp/task_generator/client.rs:573:        // Debug log all updates when ACP_DEBUG is set
src/infra/acp/task_generator/client.rs:590:                // Important: No progress update for messages because they're not the final result
src/infra/acp/task_generator/client.rs:601:                // Important: No progress update for thoughts because they're not the final result
src/infra/acp/task_generator/client.rs:604:                // Debug log tool call details
src/infra/acp/task_generator/client.rs:642:                    // Handle streaming return_task
src/infra/acp/task_generator/client.rs:656:                    // Handle finalize_review
src/infra/acp/task_generator/client.rs:677:                // Check if this is a tool completing that requires a UI sync
src/infra/acp/task_generator/worker.rs:32:/// Resolve the binary to launch for the MCP task server, preferring explicit overrides.
src/infra/acp/task_generator/worker.rs:46:/// Run ACP task generation on a dedicated Tokio runtime so GPUI stays responsive.
src/infra/acp/task_generator/worker.rs:90:/// Generate review tasks using ACP agent (runs inside Tokio runtime).
src/infra/acp/task_generator/worker.rs:109:    // Spawn agent process
src/infra/acp/task_generator/worker.rs:177:    // Create client and connection
src/infra/acp/task_generator/worker.rs:187:    let finalization_received_capture = client.finalization_received.clone(); // Add this to check finalization later
src/infra/acp/task_generator/worker.rs:189:    // Convert tokio streams for ACP
src/infra/acp/task_generator/worker.rs:201:    // Spawn IO task
src/infra/acp/task_generator/worker.rs:206:    // Initialize connection
src/infra/acp/task_generator/worker.rs:218:    // Create session with MCP task server
src/infra/acp/task_generator/worker.rs:273:    // Send prompt
src/infra/acp/task_generator/worker.rs:287:            /* always log to stderr when debug */ true,
src/infra/acp/task_generator/worker.rs:297:        // If finalization was already received, the agent successfully completed its work
src/infra/acp/task_generator/worker.rs:298:        // even if the prompt() call itself failed (e.g., due to early termination).
src/infra/acp/task_generator/worker.rs:299:        // We only fail on prompt errors if finalization was NOT received.
src/infra/acp/task_generator/worker.rs:316:    // Wait for the agent to finish naturally. If finalization is received, we allow a short
src/infra/acp/task_generator/worker.rs:317:    // grace period and then terminate to avoid hanging the UI on agents that don't exit.
src/infra/acp/task_generator/worker.rs:318:    // If no finalization is received, we may need to timeout to avoid hanging indefinitely.
src/infra/acp/task_generator/worker.rs:329:            // Immediately kill the process. We don't wait for graceful exit because
src/infra/acp/task_generator/worker.rs:330:            // the agent has explicitly signaled it is done.
src/infra/acp/task_generator/worker.rs:358:                // Check if agent exited with an error but we didn't get any tasks
src/infra/acp/task_generator/worker.rs:365:    // Wait for IO loop to flush pending notifications
src/infra/acp/task_generator/worker.rs:370:    // Get captured tasks (now stored as Vec<ReviewTask> instead of Option<Vec<ReviewTask>>)
src/infra/acp/task_generator/worker.rs:374:    // Collect output for return and for richer error contexts
src/infra/acp/task_generator/worker.rs:443:        // We can't easily test option_env without changing build environment,
src/infra/acp/task_generator/worker.rs:444:        // but we can test the fallback to current_exe.
src/infra/acp/task_generator/worker.rs:551:        // Cancel the token after a short delay
src/infra/acp/task_generator/mod.rs:1://! Task generator module for LaReview.
src/infra/acp/task_generator/mod.rs:2://!
src/infra/acp/task_generator/mod.rs:3://! Handles communication with ACP (Agent Client Protocol) agents to generate
src/infra/acp/task_generator/mod.rs:4://! review tasks from git diffs using AI agents like Codex, Qwen, and Gemini.
src/infra/acp/task_generator/validation.rs:8:    _raw_payload: Option<&serde_json::Value>, // Keep for interface compatibility but don't use
src/infra/acp/task_generator/validation.rs:11:    // Validate risk levels from the actual ReviewTask objects
src/infra/acp/task_generator/validation.rs:19:            "LOW" | "MEDIUM" | "HIGH" => {} // Valid risk level
src/infra/acp/task_generator/validation.rs:35:    // Validate diff_refs point to valid hunks in the canonical diff
src/infra/acp/task_generator/prompt.rs:15:    // Generate a hunk manifest to help agents accurately reference hunks
src/infra/acp/task_generator/tests.rs:10:// --- Helpers ---
src/infra/acp/task_generator/tests.rs:70:// --- MCP Config Tests ---
src/infra/acp/task_generator/tests.rs:87:// --- Policy Tests ---
src/infra/acp/task_generator/tests.rs:125:        // We can't easily trigger a rendering error without modifying the prompt name in build_prompt,
src/infra/acp/task_generator/tests.rs:126:        // but we can test that it's a Result.
src/infra/acp/task_generator/tests.rs:562:    /// Integration test: hits the real Codex ACP via npx.
src/infra/acp/task_generator/tests.rs:563:    /// Run with: `cargo test -- --ignored`
src/infra/acp/task_generator/tests.rs:664:        // Ensure we use the real binary, not the test harness
src/infra/acp/task_generator/tests.rs:699:    /// Ignored by default: runs the real agent and asserts tasks were persisted to SQLite.
src/infra/acp/task_generator/tests.rs:700:    /// Integration test with DB persistence.
src/infra/acp/task_generator/tests.rs:701:    /// Run with: `cargo test -- --ignored`
src/infra/acp/task_generator/tests.rs:763:        // Verify persisted tasks are present in SQLite
src/bin/reset_db.rs:8:    // Determine database path
src/bin/reset_db.rs:16:    // Check if database exists
src/bin/reset_db.rs:27:    // Store initial counts
src/bin/reset_db.rs:28:    // We use try_query because tables might not exist if it's not initialized
src/bin/reset_db.rs:56:    // Reset all tables by deleting all records
src/bin/reset_db.rs:72:    // Verify that all tables are empty
src/bin/reset_db.rs:120:        // Use a real database init to create tables first
src/bin/seed_db.rs:3:// Simple structs matching the database schema
src/bin/seed_db.rs:32:    files: String, // JSON string
src/bin/seed_db.rs:33:    stats: String, // JSON string
src/bin/seed_db.rs:47:    // Determine database path
src/bin/seed_db.rs:55:    // Ensure parent directory exists
src/bin/seed_db.rs:69:    // Sample Review based on cal.com booking audit and booking logs changes
src/bin/seed_db.rs:76:        source_json: r#"{"type":"github_pr","owner":"calcom","repo":"cal.com","number":9821,"url":"https://github.com/calcom/cal.com/pull/9821"}"#.to_string(),
src/bin/seed_db.rs:88:    // Realistic diff text for booking audit PR
src/bin/seed_db.rs:580:        input_ref: "https://github.com/calcom/cal.com/pull/9821".to_string(),
src/bin/seed_db.rs:592:    // Sample tasks modeled after real review items from the cal.com diff
src/bin/seed_db.rs:594:        // Booking logs UI and i18n
src/bin/seed_db.rs:662:        // Action services, schemas, and registry
src/bin/seed_db.rs:766:        // Task consumer, producer, and task payload
src/bin/seed_db.rs:863:        // Viewer service and reschedule context
src/bin/seed_db.rs:933:        // Actor helpers and DI wiring
src/bin/seed_db.rs:949:            diff_refs: None, // DI wiring typically doesn't reference specific hunks
src/bin/seed_db.rs:980:    // Insert all tasks
src/lib.rs:12:/// Global Tokio runtime handle for async operations throughout the application
src/utils/os.rs:60:            // Get NSWindow from NSView
src/utils/os.rs:66:            // Transparent titlebar
src/utils/os.rs:69:            // Hide title
src/utils/os.rs:70:            let _: () = msg_send![ns_window, setTitleVisibility: 1u64]; // NSWindowTitleHidden = 1
src/utils/os.rs:72:            // Rounded contentView layer
src/utils/os.rs:93:        // Rounded corners are not supported on Linux for now.
src/utils/os.rs:99:/// Try to apply native rounded corners to the OS window represented by `ptr`.
src/utils/os.rs:100:///
src/utils/os.rs:101:/// The pointer type and semantics depend on the platform (e.g. HWND on Windows,
src/utils/os.rs:102:/// NSView on macOS). Returns `Ok(())` on success or an error with details.
src/utils/os.rs:123:/// Returns true if we have a native strategy for rounded corners on this platform.
src/utils/os.rs:149:        // Just verify it doesn't crash and returns a consistent value for the platform
src/prompts/mod.rs:1://! Prompt management system for LaReview
src/prompts/mod.rs:2://! Handles template-based prompt generation using Handlebars templates
src/prompts/mod.rs:9:/// Static registry of available prompts
src/prompts/mod.rs:13:    // m.insert("other_prompt", include_str!("other_prompt.hbs"));
src/prompts/mod.rs:17:/// Render a prompt template by name with the provided context
src/prompts/mod.rs:18:/// This function uses Handlebars templating to substitute variables in the prompt
src/prompts/mod.rs:25:    hb.set_strict_mode(true); // fail if a variable is missing
src/main.rs:2://! Main entry point for the LaReview application
src/main.rs:3://! Initializes the egui application framework and sets up the Tokio runtime.
src/main.rs:8:/// Main entry point for the LaReview application
src/main.rs:9:/// Sets up the Tokio runtime and initializes the egui UI framework
src/main.rs:19:    // Check if we're running as an MCP server
src/main.rs:20:    // Also check for MCP-related environment variables that may indicate MCP mode
src/main.rs:26:        // Initialize the global Tokio runtime
src/main.rs:43:        // Enter the runtime context and run the MCP server
src/main.rs:46:        // Run the MCP server instead of the UI
src/main.rs:58:    // Initialize the global Tokio runtime for UI mode
src/main.rs:75:    // Enter the runtime context
src/main.rs:78:    // Load the app icon
src/assets.rs:1://! Embedded assets for LaReview
src/assets.rs:2://! This module provides access to assets embedded in the binary at compile time.
src/assets.rs:4:/// Get the content of an asset by its path.
src/assets.rs:5:/// Returns None if the asset is not found.
src/assets.rs:8:        // Icons
src/assets.rs:22:        // Fonts
src/application/mod.rs:1://! Application layer (use-cases, policies).
src/application/mod.rs:2://!
src/application/mod.rs:3://! This module is intended to orchestrate domain logic and define
src/application/mod.rs:4://! app-specific policies without depending on UI frameworks or storage.
src/application/review/export.rs:53:        // Generate Markdown
src/application/review/export.rs:54:        // Title
src/application/review/export.rs:64:            // Stats Overview
src/application/review/export.rs:93:            // Metadata
src/application/review/export.rs:119:            // Table of Contents
src/application/review/export.rs:181:                                    "https://github.com/{}/{}/blob/{}/{}{}",
src/application/review/export.rs:250:            // -- Selective Mode (Just Feedback) --
src/application/review/export.rs:275:    /// Renders a single feedback item as markdown, suitable for a GitHub comment.
src/application/review/export.rs:279:        let severity = feedback_impact_label(feedback.impact); // "blocking", "nitpick", etc.
src/application/review/export.rs:280:        // Capitalize severity
src/application/review/export.rs:298:                    // Capitalize first letter of agent name
src/application/review/export.rs:388:        // Completion removed
src/application/review/mod.rs:1://! Review-related application policies.
src/application/review/tests.rs:17:    // "Details" renamed to "Review Tasks"
src/application/review/tests.rs:19:    // Flow headers are now numbered
src/application/review/tests.rs:21:    // Task headers changed format
src/application/review/tests.rs:23:    // Risk is on its own line
src/application/review/tests.rs:25:    // Insight renamed
src/application/review/tests.rs:28:    // Feedback rendering (now using render_single_feedback_markdown styles)
src/application/review/tests.rs:152:    assert!(md.contains("**Severity:** ðŸ”µ Nice_to_have")); // or 'Nice_to_have' depending on implementation capitalization logic
src/application/review/tests.rs:153:    // Logic was: capitalize first char. nice_to_have -> Nice_to_have.
src/application/review/tests.rs:155:    assert!(md.contains("**Agent Claude:**")); // agent:claude -> Agent Claude
src/application/review/tests.rs:170:    // Add a hunk ref to trigger line range logic
src/application/review/tests.rs:182:    // Expected link: https://github.com/puemos/lareview/blob/sha-123/file.txt#L12-L17
src/application/review/tests.rs:186:            .contains("https://github.com/puemos/lareview/blob/sha-123/file.txt#L12-L17")
src/application/review/tests.rs:226:    // Ordered by name: A, B, ZZZ (None)
src/application/review/tests.rs:291:// Helpers
src/application/review/ordering.rs:59:        // compare_tasks is private but we can test it via tasks_in_sub_flow_display_order
src/domain/mod.rs:1://! Domain types for LaReview application
src/domain/mod.rs:2://! Defines the core data structures and business objects used throughout the application.
src/domain/mod.rs:11:/// Unique identifier for a pull request
src/domain/mod.rs:14:/// Unique identifier for a review generation run
src/domain/mod.rs:17:/// Unique identifier for a review task
src/domain/mod.rs:20:/// Risk level associated with a review task, indicating the potential impact of the changes
src/domain/mod.rs:24:    /// Low risk changes with minimal impact
src/domain/mod.rs:27:    /// Medium risk changes that require attention
src/domain/mod.rs:29:    /// High risk changes that require careful review
src/domain/mod.rs:65:/// Source for a review.
src/domain/mod.rs:69:    /// Review is based purely on a pasted diff.
src/domain/mod.rs:71:        /// Hash of the unified diff used for the run that created this review.
src/domain/mod.rs:74:    /// Review is derived from a GitHub pull request fetched locally via `gh`.
src/domain/mod.rs:88:/// A review to be generated and tracked in the app.
src/domain/mod.rs:91:    /// Unique identifier for the review.
src/domain/mod.rs:93:    /// Agent-generated title (GitHub PR title may be used as initial title).
src/domain/mod.rs:95:    /// Optional agent-generated summary of the review.
src/domain/mod.rs:97:    /// Where this review came from (diff paste or GitHub PR).
src/domain/mod.rs:99:    /// Latest run ID currently shown in the Review UI.
src/domain/mod.rs:101:    /// Creation timestamp in RFC3339 format.
src/domain/mod.rs:103:    /// Update timestamp in RFC3339 format.
src/domain/mod.rs:109:/// A single generation run for a review (diff + agent output).
src/domain/mod.rs:112:    /// Unique identifier for the run.
src/domain/mod.rs:114:    /// Parent review.
src/domain/mod.rs:116:    /// Agent id used for this run.
src/domain/mod.rs:118:    /// Raw user input reference (diff paste text or PR URL/ID).
src/domain/mod.rs:120:    /// Canonical unified diff used for this run.
src/domain/mod.rs:122:    /// Hash of `diff_text` for quick change checks/dedupe.
src/domain/mod.rs:124:    /// Creation timestamp in RFC3339 format.
src/domain/mod.rs:128:/// A reference to a specific hunk within a file's diff.
src/domain/mod.rs:131:    /// The starting line number of the hunk in the old file.
src/domain/mod.rs:133:    /// The number of lines in the hunk from the old file.
src/domain/mod.rs:135:    /// The starting line number of the hunk in the new file.
src/domain/mod.rs:137:    /// The number of lines in the hunk from the new file.
src/domain/mod.rs:141:/// A reference to changed sections of a file, represented by a list of hunks.
src/domain/mod.rs:144:    /// The path to the file that was changed.
src/domain/mod.rs:146:    /// A list of specific hunks that are relevant to a task.
src/domain/mod.rs:150:/// Statistics for a review task
src/domain/mod.rs:153:    /// Number of lines added in the changes
src/domain/mod.rs:155:    /// Number of lines deleted in the changes
src/domain/mod.rs:157:    /// Risk level of the changes
src/domain/mod.rs:159:    /// Tags describing the nature of the changes
src/domain/mod.rs:164:/// Status of a review item (task or feedback)
src/domain/mod.rs:168:    /// Work to do
src/domain/mod.rs:173:    /// Work in progress
src/domain/mod.rs:181:    /// Work completed
src/domain/mod.rs:186:    /// Work ignored or rejected
src/domain/mod.rs:232:/// A review task spanning one or more files
src/domain/mod.rs:235:    /// Unique identifier for the task
src/domain/mod.rs:237:    /// ID of the review run this task belongs to
src/domain/mod.rs:239:    /// Title of the review task
src/domain/mod.rs:241:    /// Detailed description of the review task
src/domain/mod.rs:243:    /// List of files affected by this task. Derived from `diff_refs`.
src/domain/mod.rs:245:    /// Statistical information about the changes
src/domain/mod.rs:247:    /// References to the specific diff hunks relevant to this task.
src/domain/mod.rs:250:    /// AI-generated insight about the task (optional)
src/domain/mod.rs:252:    /// Optional diagram describing the task context
src/domain/mod.rs:254:    /// Flag indicating if the task was generated by AI
src/domain/mod.rs:257:    /// Current review status of the task
src/domain/mod.rs:260:    /// Optional sub-flow name this task belongs to for organizational purposes
src/domain/mod.rs:265:/// Status of a plan entry
src/domain/mod.rs:270:    /// Plan entry has not been started yet
src/domain/mod.rs:274:    /// Plan entry is currently in progress
src/domain/mod.rs:280:    /// Plan entry has been completed
src/domain/mod.rs:285:/// Priority level of a plan entry
src/domain/mod.rs:290:    /// Low priority plan entry
src/domain/mod.rs:293:    /// Medium priority plan entry
src/domain/mod.rs:297:    /// High priority plan entry
src/domain/mod.rs:302:/// A single entry in a plan
src/domain/mod.rs:306:    /// Content/narrative description of the plan entry
src/domain/mod.rs:308:    /// Priority level of the plan entry
src/domain/mod.rs:311:    /// Current status of the plan entry
src/domain/mod.rs:314:    /// Optional metadata associated with the plan entry
src/domain/mod.rs:319:/// A plan containing multiple entries
src/domain/mod.rs:323:    /// List of plan entries
src/domain/mod.rs:325:    /// Optional metadata associated with the plan
src/domain/mod.rs:360:/// Impact/severity level for feedback
src/domain/mod.rs:364:    /// Optional/nit-level feedback
src/domain/mod.rs:367:    /// Must address before merge
src/domain/mod.rs:369:    /// Nice to have before/after merge
src/domain/mod.rs:396:/// Side of a diff line
src/domain/mod.rs:404:/// Optional anchor tying feedback to a file/line/hunk
src/domain/mod.rs:419:/// Feedback entry spanning one or more comments
src/domain/mod.rs:436:/// Comment within a feedback entry
src/domain/mod.rs:449:/// Mapping to an external provider feedback (e.g., GitHub)
